<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="viewname">
        <div class="bcca-breadcrumb">
            <div class="bcca-breadcrumb-item bg-primary-500 hover:bg-primary-700">
                <p:link outcome="/pages/backoffice/produtividadeAtendimentoBackoffice"
                        style="text-decoration: none" styleClass="text-white">PRODUTIVIDADE</p:link>
            </div>
            <div class="bcca-breadcrumb-item uppercase">RELATÓRIOS</div>
        </div>
    </ui:define>

    <ui:define name="content">

        <p:growl id="grl" widgetVar="grl" globalOnly="true" showDetail="true" life="5000">
            <p:autoUpdate/>
        </p:growl>

        <h:form id="formRelatorio" prependId="false">

            <div class="grid ui-fluid">

                <div class="col-12 md:col-3">

                    <div class="surface-card p-4 shadow-2 border-round   h-full sticky-sidebar">

                        <div class="flex align-items-center justify-content-between mb-4 border-bottom-1 border-100 pb-3">
                            <div class="flex align-items-center">
                                <i class="pi pi-filter-fill text-blue-600 text-xl mr-2"></i>
                                <span class="text-900 font-bold text-lg">Filtros</span>
                            </div>
                        </div>

                        <div class="formgrid grid ui-fluid">

                            <div class="field col-12">
                                <p:outputLabel for="selectTipoVisualizacao" value="Agrupar por" styleClass="font-bold text-700 mb-2 block"/>
                                <p:selectOneMenu id="selectTipoVisualizacao"
                                                 value="#{produtividadeConsistenciaBean.tipoVisualizacao}"
                                                 required="true" requiredMessage="Selecione o agrupamento"
                                                 autoWidth="false" styleClass="w-full">
                                    <f:selectItem itemLabel="Selecione..." itemValue=""/>
                                    <f:selectItems value="#{produtividadeConsistenciaBean.tipoVisualizacoes}"
                                                   var="tipo" itemLabel="#{tipo.constante}" itemValue="#{tipo}"/>
                                </p:selectOneMenu>
                                <p:message for="selectTipoVisualizacao" display="tooltip"/>
                            </div>

                            <div class="field col-12">
                                <p:outputLabel value="Período de Análise" styleClass="font-bold text-700 mb-2 block"/>

                                <div class="grid gap-2 m-0"> <div class="col pl-0">
                                    <span class="text-xs text-500 mb-1 block">Início</span>
                                    <p:datePicker id="calendarDataInicio" value="#{produtividadeConsistenciaBean.dataInicio}"
                                                  showIcon="true" pattern="dd/MM/yyyy" mask="true"
                                                  showButtonBar="true" monthNavigator="true" yearNavigator="true"
                                                  required="true" requiredMessage="Início obrigatório"
                                                  inputStyleClass="w-full"/>
                                </div>
                                    <div class="col pr-0">
                                        <span class="text-xs text-500 mb-1 block">Fim</span>
                                        <p:datePicker id="calendarDataFim" value="#{produtividadeConsistenciaBean.dataFim}"
                                                      showIcon="true" pattern="dd/MM/yyyy" mask="true"
                                                      showButtonBar="true" monthNavigator="true" yearNavigator="true"
                                                      required="true" requiredMessage="Fim obrigatório"
                                                      inputStyleClass="w-full"/>
                                    </div>
                                </div>
                            </div>

                            <p:divider styleClass="col-12 my-2" />

                            <div class="field col-12">
                                <p:outputLabel for="selectEquipe" value="Equipes" styleClass="font-bold text-700 mb-2 block"/>
                                <p:selectCheckboxMenu id="selectEquipe" label="Todas" multiple="true"
                                                      value="#{produtividadeConsistenciaBean.listEquipesSelecionadas}"
                                                      filter="true" filterMatchMode="contains"
                                                      updateLabel="true" emptyLabel="Selecione..."
                                                      styleClass="w-full" panelStyle="width: 18rem"> <f:selectItems value="#{produtividadeConsistenciaBean.listEquipes}" var="equipe"
                                                                                                                    itemLabel="#{equipe.nome}" itemValue="#{equipe.id}"/>

                                    <p:ajax event="toggleSelect" listener="#{produtividadeConsistenciaBean.changeEquipe()}"
                                            process="@this" update="selectUsuario"/>
                                    <p:ajax event="change" listener="#{produtividadeConsistenciaBean.changeEquipe()}"
                                            process="@this" update="selectUsuario"/>
                                </p:selectCheckboxMenu>
                            </div>

                            <div class="field col-12">
                                <p:outputLabel for="selectUsuario" value="Usuários" styleClass="font-bold text-700 mb-2 block"/>
                                <p:selectCheckboxMenu id="selectUsuario" label="Todos" multiple="true"
                                                      value="#{produtividadeConsistenciaBean.listUsuariosSelecionadas}"
                                                      filter="true" filterMatchMode="contains"
                                                      updateLabel="true" emptyLabel="Selecione..."
                                                      styleClass="w-full" panelStyle="width: 18rem">
                                    <f:selectItems value="#{produtividadeConsistenciaBean.listUsuarios}" var="usuario"
                                                   itemLabel="#{usuario.nome}" itemValue="#{usuario.id}"/>
                                </p:selectCheckboxMenu>
                            </div>

                            <div class="field col-12">
                                <p:outputLabel for="selectProduto" value="Produto" styleClass="font-bold text-700 mb-2 block"/>
                                <p:selectOneMenu id="selectProduto" value="#{produtividadeConsistenciaBean.produtoLong}"
                                                 filter="true" filterMatchMode="contains"
                                                 autoWidth="false" styleClass="w-full">
                                    <f:selectItem itemLabel="Todos os Produtos" itemValue="#{null}" noSelectionOption="true"/>
                                    <f:selectItems value="#{produtividadeConsistenciaBean.listProdutos}" var="produto"
                                                   itemLabel="#{produto.descricao}" itemValue="#{produto.id}"/>
                                </p:selectOneMenu>
                            </div>

                            <div class="field col-12 mt-4 flex flex-column gap-2">

                                <p:commandButton value="Filtrar Resultados" icon="pi pi-search"
                                                 actionListener="#{produtividadeConsistenciaBean.pesquisar()}"
                                                 update="@form"
                                                 styleClass="w-full font-bold ui-button-primary shadow-2"/>

                              <!--  <p:commandButton value="Limpar Filtros" icon="pi pi-eraser"
                                                 actionListener="#{produtividadeConsistenciaBean.limparFiltros()}"
                                                 update="@form"
                                                 process="@this"
                                                 styleClass="w-full ui-button-outlined ui-button-secondary border-0 text-600"/>-->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12 md:col-9">

                    <h:panelGroup rendered="#{empty produtividadeConsistenciaBean.listAtendimentoProdutividade}">
                        <div class="surface-card shadow-2 border-round p-6 text-center flex flex-column align-items-center justify-content-center h-full">
                            <div class="bg-blue-50 border-circle w-6rem h-6rem flex align-items-center justify-content-center mb-4">
                                <i class="pi pi-chart-bar text-blue-500 text-5xl"></i>
                            </div>
                            <span class="text-900 font-bold text-2xl mb-2">Relatório de Produtividade</span>
                            <span class="text-600 line-height-3 max-w-30rem">
                                Configure os filtros na lateral esquerda e clique em "Filtrar Resultados".
                            </span>
                        </div>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{not empty produtividadeConsistenciaBean.listAtendimentoProdutividade}">

                        <div class="surface-card shadow-2 border-round p-0 overflow-hidden">

                            <div class="p-3 bg-gray-50 border-bottom-1 border-200 flex justify-content-between align-items-center">
                                <span class="font-bold text-700 text-lg">
                                    <i class="pi pi-list mr-2"></i>Resultado Analítico
                                </span>

                                <p:commandButton value="Exportar Excel" icon="pi pi-file-excel"
                                                 styleClass="ui-button-outlined ui-button-success ui-button-sm font-bold"
                                                 ajax="false"
                                                 rendered="#{sessionScope['usuario'].permissaoExportar}">
                                    <p:dataExporter target="tableAtendimentos" type="xls" fileName="Relatorio_Produtividade"/>
                                </p:commandButton>
                            </div>

                            <p:dataTable id="tableAtendimentos" var="iten"
                                         value="#{produtividadeConsistenciaBean.listAtendimentoProdutividade}"
                                         rows="20" paginator="true" paginatorPosition="bottom"
                                         stripedRows="true" showGridlines="true" reflow="true" size="small"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                                         currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords}">

                                <p:column headerText="#{produtividadeConsistenciaBean.tipoVisualizacao.constante}" sortBy="#{iten.visualizacao}">
                                    <h:outputText value="#{iten.visualizacao}" styleClass="font-medium text-900"/>
                                </p:column>

                                <p:column headerText="Clientes" sortBy="#{iten.qtdeCpf}" styleClass="text-center" width="100">
                                    <h:outputText value="#{iten.qtdeCpf}"/>
                                </p:column>

                                <p:column headerText="Atendimentos" sortBy="#{iten.qtdeAtendimento}" styleClass="text-center" width="110">
                                    <h:outputText value="#{iten.qtdeAtendimento}" styleClass="font-bold"/>
                                </p:column>

                                <p:column headerText="Pendentes" sortBy="#{iten.qtidadeEmAberto}" styleClass="text-center" width="110">
                                    <h:outputText value="#{iten.qtidadeEmAberto}" styleClass="font-bold"/>
                                </p:column>

                                <p:column headerText="Concluído N1" sortBy="#{iten.qtdadeResolvidoN1}" styleClass="text-center">
                                    <h:outputText value="#{iten.qtdadeResolvidoN1}"/>
                                </p:column>

                                <p:column headerText="Derivado" sortBy="#{iten.qtdeDerivado}" styleClass="text-center">
                                    <h:outputText value="#{iten.qtdeDerivado}"/>
                                </p:column>

                                <p:column headerText="Concluído N2" sortBy="#{iten.qtdeResolvidoN2}" styleClass="text-center">
                                    <h:outputText value="#{iten.qtdeResolvidoN2}" />
                                </p:column>

                                <p:column headerText="FCR (Qtd)" sortBy="#{iten.qtdeFcr}" styleClass="text-center">
                                    <h:outputText value="#{iten.qtdeFcr}"/>
                                </p:column>

                                <p:column headerText="% FCR" sortBy="#{iten.percentualFcr}" styleClass="text-center">
                                        <h:outputText value="#{iten.percentualFcr}">
                                            <f:convertNumber type="percent" minFractionDigits="1" />
                                        </h:outputText>


                                                            </p:column>
                                <p:column headerText="No Prazo" sortBy="#{iten.qtdadeDemandaNoPrazo}" styleClass="text-center text-green-600 font-bold">
                                    <h:outputText value="#{iten.qtdadeDemandaNoPrazo}"/>
                                </p:column>

                                <p:column headerText="Fora Prazo" sortBy="#{iten.qtdadeDemandaPrazoEstourado}" styleClass="text-center text-red-500 font-bold">
                                    <h:outputText value="#{iten.qtdadeDemandaPrazoEstourado}"/>
                                </p:column>

                                <p:column headerText="% No Prazo" sortBy="#{iten.percentualNoPrazo}" styleClass="text-center">
                                    <h:outputText value="#{iten.percentualNoPrazo}">
                                        <f:convertNumber type="percent" minFractionDigits="1" />
                                    </h:outputText>
                                </p:column>

                                <p:column headerText="% Excedido" sortBy="#{iten.percentualPrazoEstourado}" styleClass="text-center">
                                    <h:outputText value="#{iten.percentualPrazoEstourado}">
                                        <f:convertNumber type="percent" minFractionDigits="1" />
                                    </h:outputText>
                                </p:column>

                                <p:columnGroup type="footer">
                                    <p:row>
                                        <p:column footerText="TOTAIS:" style="text-align:right; font-weight: bold;"/>
                                        <p:column footerText="#{produtividadeConsistenciaBean.totalCpf}" style="text-align:center; font-weight: bold;"/>
                                        <p:column footerText="#{produtividadeConsistenciaBean.totalAtendimento}" style="text-align:center; font-weight: bold;"/>
                                        <p:column footerText="#{produtividadeConsistenciaBean.totalAberto}" style="text-align:center; font-weight: bold;"/>
                                        <p:column footerText="#{produtividadeConsistenciaBean.totalResolvidoN1}" style="text-align:center; font-weight: bold;"/>
                                        <p:column footerText="#{produtividadeConsistenciaBean.totalDerivado}" style="text-align:center; font-weight: bold;"/>
                                        <p:column footerText="#{produtividadeConsistenciaBean.totalResolvidoN2}" style="text-align:center; font-weight: bold;"/>

                                        <p:column footerText="#{produtividadeConsistenciaBean.totalFcr}" style="text-align:center; font-weight: bold; color: var(--blue-600);"/>

                                        <p:column style="text-align:center; font-weight: bold;">
                                            <f:facet name="footer">
                                                <h:outputText value="#{produtividadeConsistenciaBean.totalPercentualFcr}">
                                                    <f:convertNumber type="percent" minFractionDigits="1" />
                                                </h:outputText>
                                            </f:facet>
                                        </p:column>
                                        <p:column footerText="#{produtividadeConsistenciaBean.totalNoPrazo}" style="text-align:center; font-weight: bold;"/>
                                        <p:column footerText="#{produtividadeConsistenciaBean.totalPrazoExcedido}" style="text-align:center; font-weight: bold;"/>
                                        <p:column footerText="#{produtividadeConsistenciaBean.totalPercentualNoPrazoFormatado}"  style="text-align:center; font-weight: bold;"/>

                                        <p:column footerText="#{produtividadeConsistenciaBean.totalPercentualPrazoExcedidoFormatado}" style="text-align:center; font-weight: bold;" />


                                    </p:row>
                                </p:columnGroup>

                            </p:dataTable>
                        </div>
                    </h:panelGroup>

                </div>
            </div>

        </h:form>

    </ui:define>

</ui:composition>