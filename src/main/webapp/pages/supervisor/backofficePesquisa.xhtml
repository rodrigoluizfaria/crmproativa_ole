<ui:fragment xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:matriz="http://java.sun.com/jsf/composite/componentes"
	xmlns:p="http://primefaces.org/ui">

	<h:form id="formBackofficePesquisa" prependId="false">

		<div class="grid col-12 tab-padding">

			<div class="col-12">
			
				<p:spacer height="20" />
				
			</div>
			
			<h:panelGroup   layout="block" rendered="#{sessionScope['usuario'].empresa.possuiFiliais}">
	
				<matriz:selectEmpresa id="cmpEmpresa" managedBean="#{supervisorBackofficeBean}"	value="#{supervisorBackofficeBean.empresa}" ajax="true" update="@form"	filter="true" exibirSelecione="true"
								selecioneItemLabel="Selecione" required="true" style="col-12 md:col-3"  />
			</h:panelGroup>
			
			<div class="field col-12 md:col-2">

				<p:outputLabel value="Campanha:" />

				<p:selectOneMenu id="selectCampanhaPesquisa"	value="#{supervisorBackofficeBean.campanhaPesquisa}"  filter="true" filterMatchMode="contains" autoWidth="false">

					<f:selectItem itemLabel="Selecione" itemValue="" />

					<f:selectItems value="#{supervisorBackofficeBean.listCampanha}"	var="campanha" itemLabel="#{campanha.descricao}" itemValue="#{campanha.id}" />

				</p:selectOneMenu>

			</div>
			
			<div class="field col-12 md:col-2">

				<p:outputLabel value="Equipe:" />
<!-- 
				<p:selectOneMenu id="selectEquipe"	value="#{supervisorBackofficeBean.equipe}"  filter="true" filterMatchMode="contains" autoWidth="false">

					<f:selectItem itemLabel="Selecione" itemValue="" />

					<f:selectItems value="#{supervisorBackofficeBean.listEquipes}"	var="equipe" itemLabel="#{equipe.nome}" itemValue="#{equipe.id}" />
					<p:ajax listener="#{supervisorBackofficeBean.onChangeEquipe(supervisorBackofficeBean.equipe)}" update="pnpAgent" global="false"/>

				</p:selectOneMenu> -->
				
				<p:selectCheckboxMenu id="selectEquipe" emptyLabel="Selecione" label="Selecione" multiple="true"  showHeader="true" dynamic="true"	value="#{supervisorBackofficeBean.listIdsEquipes}"  filter="true" filterMatchMode="contains" autoWidth="false">

					<f:selectItems value="#{supervisorBackofficeBean.listEquipes}"	var="equipe" itemLabel="#{equipe.nome}" itemValue="#{equipe.id}" />
					<p:ajax process="@this" listener="#{supervisorBackofficeBean.onChangeEquipe()}" update="pnpAgent" global="false"/>
					<p:ajax process="@this" event="toggleSelect" listener="#{supervisorBackofficeBean.onChangeEquipe()}" update="pnpAgent" global="false"/>
					<p:ajax process="@this" event="itemUnselect" listener="#{supervisorBackofficeBean.onChangeEquipe()}" update="pnpAgent" global="false"/>
					
				</p:selectCheckboxMenu>

			</div>
			
			<h:panelGroup styleClass="field col-12 md:col-2" layout="block" id="pnpAgent">

				<p:outputLabel value="Operador:" />
				
				<!--   (<p:selectBooleanCheckbox  itemLabel="Exibir inativos" style="margin-left: 10px; height:auto; width:auto; padding-top: 3px" />) -->

			<!-- 	<p:selectOneMenu id="selectOperador"	value="#{supervisorBackofficeBean.operador}" filter="true" filterMatchMode="contains" autoWidth="false" >

					<f:selectItem itemLabel="Selecione" itemValue="" />

					<f:selectItems value="#{supervisorBackofficeBean.listOperador}"	var="operador" itemLabel="#{operador.nome}" itemValue="#{operador.id}"  />

				</p:selectOneMenu> -->
				
				<p:selectCheckboxMenu id="selectOperador"	label="Selecione"	multiple="true" value="#{supervisorBackofficeBean.listAgentes}" filter="true" filterMatchMode="contains" autoWidth="false" >
				
					<f:selectItems value="#{supervisorBackofficeBean.listOperador}"	var="operador" itemLabel="#{operador.nome}" itemValue="#{operador.id}"  />

				</p:selectCheckboxMenu>

		
	</h:panelGroup>
			
			<div class="field col-12 md:col-2">

				<p:outputLabel value="Status: " />

		<!--		<p:selectOneMenu id="selectStatus"	value="#{supervisorBackofficeBean.statusAtendimento}"  filter="true" filterMatchMode="contains" autoWidth="false">

					<f:selectItem itemLabel="Selecione" itemValue="" />

					<f:selectItems value="#{supervisorBackofficeBean.listStatusAtendimento}" var="status" itemLabel="#{status.descricao}" itemValue="#{status.id}" />

				</p:selectOneMenu>-->


				<p:selectCheckboxMenu id="selectStatus" emptyLabel="Selecione" label="Selecione" multiple="true"  	value="#{supervisorBackofficeBean.listIdsStatusAtendimentos}"  filter="true" filterMatchMode="contains" autoWidth="false">

					<f:selectItems value="#{supervisorBackofficeBean.listStatusAtendimento}"	var="status" itemLabel="#{status.descricao}" itemValue="#{status.id}" />

				</p:selectCheckboxMenu>


			</div>
			
			<div class="field col-12 md:col-2">

				<p:outputLabel value="Produto: " />

				<p:selectOneMenu id="selectProduto"	value="#{supervisorBackofficeBean.produto}"  filter="true" filterMatchMode="contains" autoWidth="false">

					<f:selectItem itemLabel="Selecione" itemValue="" />

					<f:selectItems value="#{supervisorBackofficeBean.listProdutos}" var="produto" itemLabel="#{produto.descricao}" itemValue="#{produto.id}" />

				</p:selectOneMenu>

			</div>

			<div class="field col-12 md:col-2">

				<p:outputLabel value="CPF:" />

				<p:inputText id="txtCpfPesquisa" value="#{supervisorBackofficeBean.cpf}" />

			</div>

			<div class="field col-12 md:col-2">

				<p:outputLabel value="Nome:" />

				<p:inputText id="txtNomePesquisa"	value="#{supervisorBackofficeBean.nome}" />

			</div>

			<div class="field col-12 md:col-2">

				<p:outputLabel value="Adesão:" />

				<p:inputText id="txtAdesaoPesquisa" value="#{supervisorBackofficeBean.adesao}" />

			</div>
			
			<div class="field col-12 md:col-2">

				<p:outputLabel value="Tiket:" />

				<p:inputText id="txtTiketPesquisa" value="#{supervisorBackofficeBean.tiket}" />

			</div>
			
			<div class="field col-12 md:col-2">

				<p:outputLabel value="Protocolo:" />

				<p:inputText id="txtProtocoloPesquisa" value="#{supervisorBackofficeBean.protocolo}" />

			</div>

			<div class="field col-12 md:col-2">

				<p:outputLabel value="Data inicio:" />

				<p:datePicker id="calendarDataInicioPesquisa" value="#{supervisorBackofficeBean.dataInicio}" showButtonBar="true" showIcon="true" monthNavigator="true" yearNavigator="true" showWeek="true"  pattern="dd/MM/yyyy" />

			</div>

			<div class="field col-12 md:col-2">

				<p:outputLabel value="Data fim:" />

				<p:datePicker id="calendarDataFimPesquisa"	value="#{supervisorBackofficeBean.dataFim}" showButtonBar="true" monthNavigator="true" yearNavigator="true" showWeek="true"  showIcon="true"  pattern="dd/MM/yyyy" />

			</div>

			<div class="field col-12 ">

				<p:outputLabel value="&#160;&#160;" id="txtPesquisaEspaco" />

				<div>
				
					<p:commandButton value="Pesquisar" icon="pi pi-search" styleClass="ui-button-raised mr-3" actionListener="#{supervisorBackofficeBean.pesquisarAtendimentosCount()}" update="@form" />
				
					<p:menuButton  style="width:auto" id="btnExportarPesquisa"  value="#{msg.exportar}" styleClass="ui-button-secondary ui-button-raised" disabled="#{supervisorBackofficeBean.listModel.rowCount eq 0}"	 rendered="#{sessionScope['usuario'].permissaoExportar}">

           				 <p:menuitem value="Exportar simples"  icon="pi pi-download" ajax="false" disabled="#{supervisorBackofficeBean.listModel.rowCount eq 0}"  >
           					 <p:fileDownload value="#{supervisorBackofficeBean.fileSimples}"  />
           				 </p:menuitem> 

					 	<p:menuitem value="Exportar completo" ajax="false" icon="fa fa-download"  onclick="PF('progressAjax').start();PF('statusDialogBack').show();" update="statusDialogBack" global="false">
							
							<p:fileDownload value="#{supervisorBackofficeBean.file}"  />
						
						</p:menuitem>
						
					 	<p:menuitem value="Exportar Manifesto" ajax="false" icon="fa fa-download"  onclick="PF('progressAjax').start();PF('statusDialogBack').show();" update="statusDialogBack" global="false">
							
							<p:fileDownload value="#{supervisorBackofficeBean.fileManifesto}"  />
						
						</p:menuitem>

					</p:menuButton>
					
				</div>

			</div>
			
			<style type="text/css">
				.ui-datatable-header {
				height: 50px
			}
			</style>


			<div class="mt-4 ">

				<p:dataTable id="tableAtendimentos" var="atendimento" rows="10"	paginator="true" paginatorPosition="bottom"	value="#{supervisorBackofficeBean.listModel}"  reflow="true"
					emptyMessage="#{supervisorBackofficeBean.listModel eq null? '' : msg.emptyMessage}"	currentPageReportTemplate="[#{msg.totalDeRegistros}: {totalRecords}]"
					paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {Exporters}" styleClass="ui-datatable-sm ui-datatable-striped  ui-datatable-gridlines" style="zoom: 90%;">

					<p:ajax event="page" global="false"  onstart="PF('blockUIWidget2').block()" oncomplete="PF('blockUIWidget2').unblock()" />

					<p:ajax event="sort" global="false"  onstart="PF('blockUIWidget2').block()" oncomplete="PF('blockUIWidget2').unblock()"/>

					<f:facet name="header">
        
<!--  			<div class="  ui-toolbar-group-right">
			
			<p:commandButton id="toggler" type="button" value="Colunas" 	 icon="pi pi-align-justify" />
						<p:columnToggler datasource="tableAtendimentos" trigger="toggler" />
						
			
			</div> -->
        				
					</f:facet>

					<p:column headerText="Data" sortBy="#{atendimento[5]}" width="10%" >

						<h:outputLabel value="#{atendimento[5]}">

							<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" />

						</h:outputLabel>
							<f:facet name="footer" >
						
						<h:outputLabel value="TOTAL: " >
								
							</h:outputLabel>
							</f:facet>

					</p:column>

					<p:column headerText="Campanha" sortBy="#{atendimento[1]}"	width="12%">

						<h:outputLabel value="#{atendimento[1]}" />

					</p:column>

					<p:column headerText="Cliente" sortBy="#{atendimento[2]}" width="15%">

						<h:outputLabel value="#{atendimento[2]}" />

					</p:column>

					<p:column headerText="CPF" sortBy="#{atendimento[3]}" width="9%">

						<h:outputLabel value="#{atendimento[3]}" />

					</p:column>
					
					
					<p:column headerText="Agente" sortBy="#{atendimento[6]}" width="10%">

						<h:outputLabel value="#{atendimento[6]}" />

					</p:column>

					<p:column headerText="Adesão" sortBy="#{atendimento[7]}" width="5%">

						<h:outputLabel value="#{atendimento[7]}" />

					</p:column>

			<!-- 		<p:column headerText="Protocolo" sortBy="#{atendimento[11]}" width="10%">

						<h:outputLabel value="#{atendimento[11]}" />

					</p:column> -->

					<p:column headerText="Status" sortBy="#{atendimento[4]}" width="10%">

						<h:outputLabel value="#{atendimento[4]}" />

					</p:column>
					
					<p:column headerText="Produto" sortBy="#{atendimento[19]}" width="10%">

						<h:outputLabel value="#{atendimento[19]}" />

					</p:column>
					
					<p:column headerText="Tempo pós Atn" sortBy="#{atendimento[20]}" width="8%">

						<h:outputLabel value="#{atendimento[20]} #{atendimento[20] eq null ? '':'s'}"  />

					</p:column>

		<!-- 		<p:column headerText="Qtdade Parcelas" sortBy="#{atendimento[8]}" width="5%">

						<h:outputLabel value="#{atendimento[8]}" />

					</p:column>

					<p:column headerText="Valor Parcelas" sortBy="#{atendimento[9]}" width="5%">

						<h:outputLabel value="#{atendimento[9]}" >
							<f:convertNumber type="currency" locale="pt-br" currencySymbol="R$"/>
						</h:outputLabel>

					</p:column> -->

					<p:column headerText="Valor Liberado" sortBy="#{atendimento[10]}"	width="5%" >

						<h:outputLabel value="#{atendimento[10]}" >
							<f:convertNumber type="currency" locale="pt-br" currencySymbol="R$"/>
						</h:outputLabel>
						

						<f:facet name="footer" >
						
            					<h:outputLabel value="#{supervisorBackofficeBean.total}" >
									<f:convertNumber type="currency" locale="pt-br" currencySymbol="R$"/>
							</h:outputLabel>
      					  </f:facet>

					</p:column>

					<p:column width="7%" exportable="false" toggleable="false">

						<p:commandButton styleClass="rounded-button ui-button-flat" icon="fa fa-list-alt" onclick="PF('dlgVisualizarAtendimento').show()" update=":formVisualizar" title="Visualizar" immediate="true" action="#{supervisorBackofficeBean.visualizarAtendimento(atendimento[0])}"/>
					
						<p:commandButton styleClass="rounded-button ui-button-flat" icon="fa fa-fw fa-edit" onclick="topFunction();PF('dlgVisualizarEditar').show();" update="editarAtendimento:formEditarAtendimentor" title="Editar"  immediate="true"  action="#{supervisorBackofficeBean.visualizarAtendimento(atendimento[0])}"/>
						
						<p:commandButton styleClass="rounded-button ui-button-flat" icon="fa fa-headphones"  update="dlgAudio" title="Visualizar áudios" immediate="true"  action="#{supervisorBackofficeBean.onConciliar(atendimento[0],atendimento[2])}"/>
						
				</p:column>
				

				</p:dataTable>
				
		
        
        <pe:blockUI target="tableAtendimentos" content="blockUIContent" widgetVar="blockUIWidget2"/>

			</div>

		</div>
	
	<h:panelGrid id="blockUIContent" columns="2" style="display:none;table-layout:auto;background-color:#fff">
  		
  			<i class="pi pi-spin pi-spinner" style="font-size: 3rem" />
  		  <h:outputText value="Aguarde, processando....." style="white-space: nowrap;"/>
	</h:panelGrid>

	</h:form>
	

</ui:fragment>