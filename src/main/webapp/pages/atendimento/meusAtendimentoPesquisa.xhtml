<ui:fragment xmlns="http://www.w3.org/1999/xhtml"
             xmlns:h="http://java.sun.com/jsf/html"
             xmlns:f="http://java.sun.com/jsf/core"
             xmlns:pe="http://primefaces.org/ui/extensions"
             xmlns:ui="http://java.sun.com/jsf/facelets"
             xmlns:p="http://primefaces.org/ui">

    <h:form id="formAtendimentoPesquisa" prependId="false">

        <div class="ui-fluid">

            <div class="flex align-items-center mb-4 text-700">
                <i class="pi pi-filter mr-2"></i>
                <span class="font-bold text-lg">Critérios de Pesquisa</span>
            </div>

            <div class="grid formgrid mb-4">

                <div class="field col-12 md:col-3">
                    <p:outputLabel value="Status Atendimento" for="selectStatusAtn" styleClass="font-bold mb-2 block"/>
                    <p:selectOneMenu id="selectStatusAtn" value="#{meusAtendimentosBean.idSatusAtendimento}"
                                     filter="true" filterMatchMode="contains">
                        <f:selectItem itemLabel="Todos" itemValue="" noSelectionOption="true"/>
                        <f:selectItems value="#{meusAtendimentosBean.listStatusAtendimentos}" var="st"
                                       itemLabel="#{st.descricao}" itemValue="#{st.id}"/>
                    </p:selectOneMenu>
                </div>

                <div class="field col-12 md:col-3">
                    <p:outputLabel value="Motivo" for="selectMotivo" styleClass="font-bold mb-2 block"/>
                    <p:selectOneMenu id="selectMotivo" value="#{meusAtendimentosBean.idMotivo}" filter="true"
                                     filterMatchMode="contains">
                        <f:selectItem itemLabel="Todos" itemValue="" noSelectionOption="true"/>
                        <f:selectItems value="#{meusAtendimentosBean.listMotivos}" var="m" itemLabel="#{m.descricao}"
                                       itemValue="#{m.id}"/>
                        <p:ajax process="@this" listener="#{meusAtendimentosBean.trocarMotivo()}"
                                update="selectSubMotivo"/>
                    </p:selectOneMenu>
                </div>

                <div class="field col-12 md:col-3">
                    <p:outputLabel value="Submotivo" for="selectSubMotivo" styleClass="font-bold mb-2 block"/>
                    <p:selectOneMenu id="selectSubMotivo" value="#{meusAtendimentosBean.idSubMotivo}" filter="true"
                                     filterMatchMode="contains">
                        <f:selectItem itemLabel="Todos" itemValue="" noSelectionOption="true"/>
                        <f:selectItems value="#{meusAtendimentosBean.listSubMotivos}" var="s" itemLabel="#{s.descricao}"
                                       itemValue="#{s.id}"/>
                    </p:selectOneMenu>
                </div>

                <div class="field col-12 md:col-3"></div>


                <div class="field col-12 md:col-4">
                    <p:outputLabel value="Nome do Cliente" for="txtNomePesquisa" styleClass="font-bold mb-2 block"/>
                    <div class="ui-inputgroup">
                        <span class="ui-inputgroup-addon"><i class="pi pi-user"></i></span>
                        <p:inputText id="txtNomePesquisa" value="#{meusAtendimentosBean.nome}" placeholder="Nome..."/>
                    </div>
                </div>

                <div class="field col-12 md:col-3">
                    <p:outputLabel value="CPF" for="txtCpfPesquisa" styleClass="font-bold mb-2 block"/>
                    <div class="ui-inputgroup">
                        <span class="ui-inputgroup-addon"><i class="pi pi-id-card"></i></span>
                        <p:inputText id="txtCpfPesquisa" value="#{meusAtendimentosBean.cpf}"
                                     placeholder="Apenas números"/>
                    </div>
                </div>

                <div class="field col-12 md:col-2">
                    <p:outputLabel value="Adesão / Protocolo" for="txtProtocoloPesquisa"
                                   styleClass="font-bold mb-2 block"/>
                    <p:inputText id="txtProtocoloPesquisa" value="#{meusAtendimentosBean.adesao}"/>
                </div>


                <div class="field col-12 md:col-3">
                    <p:outputLabel value="Data Início" for="calendarDataInicioPesquisa"
                                   styleClass="font-bold mb-2 block"/>
                    <p:datePicker id="calendarDataInicioPesquisa" value="#{meusAtendimentosBean.dataInicio}"
                                  showIcon="true" pattern="dd/MM/yyyy" locale="pt_BR" placeholder="dd/mm/aaaa"/>
                </div>

                <div class="field col-12 md:col-3">
                    <p:outputLabel value="Data Fim" for="calendarDataFimPesquisa" styleClass="font-bold mb-2 block"/>
                    <p:datePicker id="calendarDataFimPesquisa" value="#{meusAtendimentosBean.dataAFim}"
                                  showIcon="true" pattern="dd/MM/yyyy" locale="pt_BR" placeholder="dd/mm/aaaa"/>
                </div>

                <div class="field col-12 md:col-6 flex align-items-end justify-content-end gap-2">

                    <p:commandButton value="Pesquisar" icon="pi pi-search"
                                     actionListener="#{meusAtendimentosBean.pesquisarAtendimentos()}"
                                     update="tableAtendimentos btnExportarPesquisa"
                                     styleClass="ui-button-primary font-bold px-4 shadow-1"/>

                    <p:commandButton id="btnExportarPesquisa" value="#{msg.exportar}" icon="pi pi-file-excel"
                                     styleClass="ui-button-outlined ui-button-success font-bold"
                                     ajax="false"
                                     disabled="#{empty meusAtendimentosBean.listAtendimentos}"
                                     rendered="#{sessionScope['usuario'].permissaoExportar}">
                        <p:dataExporter target="tableAtendimentos" type="xls" fileName="relatorio_atendimentos"/>
                    </p:commandButton>
                </div>

            </div>

            <p:divider styleClass="my-4"/>

            <div class="mt-2">
                <p:dataTable id="tableAtendimentos" var="atendimento"
                             value="#{meusAtendimentosBean.listAtendimentos}"
                             rows="10" paginator="true" paginatorPosition="bottom"
                             emptyMessage="#{meusAtendimentosBean.listAtendimentos eq null ? '' : msg.emptyMessage}"
                             stripedRows="true" showGridlines="true" reflow="true" size="small"
                             rowKey="#{atendimento[0]}"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {Exporters}"
                             currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords}">

                    <p:column headerText="Data" sortBy="#{atendimento[5]}" width="110" styleClass="text-center">
                        <h:outputText value="#{atendimento[5]}">
                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="GMT-3"/>
                        </h:outputText>
                    </p:column>

                    <p:column headerText="Campanha" sortBy="#{atendimento[1]}" width="120">
                        <h:outputText value="#{atendimento[1]}" styleClass="font-medium"/>
                    </p:column>

                    <p:column headerText="Nome" sortBy="#{atendimento[2]}">
                        <h:outputText value="#{atendimento[2]}"/>
                    </p:column>

                    <p:column headerText="CPF" sortBy="#{atendimento[3]}" width="120">
                        <h:outputText value="#{meusAtendimentosBean.onOcultarCpf(atendimento[3])}"/>
                    </p:column>

                    <p:column headerText="Adesão" sortBy="#{atendimento[7]}" width="90" styleClass="text-center">
                        <h:outputText value="#{atendimento[7]}"/>
                    </p:column>

                    <p:column headerText="Protocolo" sortBy="#{atendimento[11]}" width="110" styleClass="text-center">
                        <span class="bg-gray-100 px-2 border-round text-sm font-bold text-700">#{atendimento[11]}</span>
                    </p:column>

                    <p:column headerText="Status" sortBy="#{atendimento[4]}" width="120">
                        <h:outputText value="#{atendimento[4]}"/>
                    </p:column>

                    <p:column headerText="Motivo / Detalhe" sortBy="#{atendimento[22]}" width="200">

                        <div class="flex flex-column">
                            <span class="font-medium text-900 mb-1">
                                #{atendimento[22]}
                            </span>

                            <div class="flex align-items-center text-500">
                                <i class="pi pi-level-down text-xs mr-1 transform rotate-90"></i>
                                <span class="text-sm">#{atendimento[23]}</span>
                            </div>
                        </div>

                    </p:column>

                    <p:column headerText="Parc." sortBy="#{atendimento[8]}" width="60" styleClass="text-center">
                        <h:outputText value="#{atendimento[8]}"/>
                    </p:column>

                    <p:column headerText="Vl. Parcela" sortBy="#{atendimento[9]}" width="100" styleClass="text-right">
                        <h:outputText value="#{atendimento[9]}">
                            <f:convertNumber type="currency" locale="pt-br" currencySymbol="R$"/>
                        </h:outputText>
                    </p:column>

                    <p:column headerText="Liberado" sortBy="#{atendimento[10]}" width="100"
                              styleClass="text-right font-bold text-green-600">
                        <h:outputText value="#{atendimento[10]}">
                            <f:convertNumber type="currency" locale="pt-br" currencySymbol="R$"/>
                        </h:outputText>
                    </p:column>

                    <p:column width="60" styleClass="text-center" exportable="false">
                        <p:commandButton icon="pi pi-eye"
                                         styleClass="rounded-button ui-button-flat ui-button-secondary"
                                         onclick="PF('dlgVisualizarAtendimento').show();"
                                         update="formVisualizar"
                                         action="#{meusAtendimentosBean.visualizarAtendimento(atendimento[0])}"
                                         title="Ver Detalhes"/>
                    </p:column>

                </p:dataTable>
            </div>

        </div>

        <pe:tooltip global="true" myPosition="left center" atPosition="right center" styleClass="qtip-default"/>

    </h:form>

</ui:fragment>