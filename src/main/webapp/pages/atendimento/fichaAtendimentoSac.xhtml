<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="viewname">
        <div class="bcca-breadcrumb">
            <div class="bcca-breadcrumb-item bg-primary-500 hover:bg-primary-700">
                <p:link outcome="/pages/atendimento/fichaAtendimento2" style="text-decoration: none">
                    ATENDIMENTO #{fichaAtendimentoBean.tituloDaPagina.toUpperCase()}
                </p:link>
                <i class="fa fa-solid fa-headset text-white"/>
            </div>
            <div class="bcca-breadcrumb-item ">ATENDIMENTO</div>
        </div>
    </ui:define>

    <ui:define name="content">
        <audio id="audioNotificacao" preload="auto">
            <source src="https://www.soundjay.com/buttons/beep-07a.mp3" type="audio/mpeg"/>
        </audio>

        <style type="text/css">
            .status-header {
                background-color: #f8f9fa;
                border-bottom: 1px solid #dee2e6;
            }

            .card-tma {
                background-color: #e3f2fd;
                border-left: 5px solid #2196f3;
            }

            .card-tme {
                background-color: #e8f5e9;
                border-left: 5px solid #4caf50;
            }

            .card-contatos {
                background-color: #fff3e0;
                border-left: 5px solid #ff9800;
            }

            .card-fcr {
                background-color: #fffde7;
                border-left: 5px solid #fbc02d;
            }

            .limite-valor {
                font-size: 1.2rem;
                font-weight: bold;
                color: #5c2d91;
            }

            .tag-vip {
                background-color: #ffd700;
                color: #000;
                font-weight: bold;
                padding: 2px 8px;
                border-radius: 4px;
            }

            .tag-new {
                background-color: #e0f2fe; /* Azul bem claro */
                color: #0284c7; /* Azul forte */
                font-weight: 700;
                padding: 3px 12px;
                border-radius: 6px;
                border: 1px solid #bae6fd;
                font-size: 0.75rem;
                letter-spacing: 0.5px;
                box-shadow: 0 2px 4px rgba(168, 85, 247, 0.2)
            }

            .tag-gold-gradient {
                /* Substitui o background-color */
                background: linear-gradient(135deg, #ffe259 0%, #ffa751 100%);
                color: #5d4037; /* Marrom escuro para contraste melhor que preto */
                border: none; /* Remove bordas padrão para o gradiente brilhar */
                font-weight: 600;
                padding: 3px 12px;
                border-radius: 20px;
                font-size: 0.75rem;
                letter-spacing: 0.5px;
                box-shadow: 0 2px 4px rgba(168, 85, 247, 0.2)
            }

            .base-tag {

            }


            .tag-premium {
                background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); /* Roxo para Violeta */
                color: #ffffff;
                font-weight: 600;
                padding: 3px 12px;
                border-radius: 20px;
                font-size: 0.75rem;
                box-shadow: 0 2px 4px rgba(168, 85, 247, 0.2);
            }

            .badge-pill {
                border-radius: 999px !important;
                padding-left: 12px;
                padding-right: 12px;
            }

        </style>

        <div class="p-grid justify-center">



            <div class="ui-fluid">

                <div class="p-grid">

                    <h:form prependId="false" id="formConteudo">

                        <h:panelGroup rendered="#{fichaAtendimentoSacBean.atendimento ne null}"
                                      id="pmpPrincipalAtendimento">

                            <div class="grid grid-nogutter">

                                <div class="col-12 p-4 bg-gray-100">

                                    <div class="card p-3 mb-4 shadow-1 flex justify-content-between align-items-center bg-white border-round">
                                        <div class="flex align-items-center">
                                            <div class="bg-blue-600 p-2 border-round mr-3">
                                                <i class="pi pi-building text-white text-2xl"></i>
                                            </div>
                                            <div>
                                                <h4 class="m-0">Central de Atendimento SAC</h4>
                                                <small class="text-600">Conforme Decreto 11.034/2022</small>
                                            </div>
                                        </div>

                                        <div class="card mb-4 p-3 border-round-xl shadow-1 surface-card">

                                            <div class="flex flex-column md:flex-row justify-content-between align-items-center gap-3">

                                                <div class="flex align-items-center flex-wrap gap-3">

                                                    <p:tag icon="pi pi-phone"
                                                           value="#{empty fichaAtendimentoSacBean.campanha ? 'SEM CANAL' : fichaAtendimentoSacBean.campanha.descricao}"
                                                           severity="#{empty fichaAtendimentoSacBean.campanha ? 'info' : 'warning'}"
                                                           styleClass="uppercase font-bold text-sm px-3"/>

                                                    <div class="surface-100 border-1 border-200 border-round-2xl px-3 py-1 flex align-items-center h-full">
                                                        <div class="bg-white border-circle w-1rem h-1rem flex align-items-center justify-content-center mr-2 shadow-1">
                                                            <i class="pi pi-directions text-gray-500 text-xs"></i>
                                                        </div>
                                                        <span class="text-500 font-bold text-xs uppercase mr-2">Opção URA:</span>
                                                        <span class="text-900 font-bold font-monospace">
                    #{empty fichaAtendimentoSacBean.opcao ? 'N/A' : fichaAtendimentoSacBean.opcao}
                </span>
                                                    </div>
                                                </div>

                                                <div class="flex align-items-center gap-2">

                                                    <div class="surface-50 border-1 border-200 border-round px-3 py-2 flex align-items-center mr-2">
                                                        <span class="text-500 font-bold text-xs mr-2 uppercase">Protocolo:</span>
                                                        <span class="text-blue-900 font-bold font-monospace select-all text-lg">
                    #{fichaAtendimentoSacBean.cliente.protocolo}
                </span>
                                                        <div class="border-left-1 border-300 mx-2 h-1rem"></div>
                                                        <p:commandLink title="Copiar"
                                                                       styleClass="text-400 hover:text-primary transition-colors transition-duration-200"
                                                                       onclick="copiarTexto('#{fichaAtendimentoSacBean.cliente.protocolo}'); return false">
                                                            <i class="pi pi-copy"></i>
                                                        </p:commandLink>
                                                    </div>

                                                    <p:commandButton value="Pausa"
                                                                     icon="pi pi-pause"
                                                                     update="dlgPausa"
                                                                     process="@this"
                                                                     oncomplete="PF('dlgPausa').show();"
                                                                     actionListener="#{fichaAtendimentoSacBean.onListarPausa()}"
                                                                     styleClass="ui-button-outlined ui-button-warning border-round-lg font-bold shadow-none"
                                                                     title="Iniciar pausa"/>

                                                    <p:commandButton value="Encerrar"
                                                                     icon="pi pi-phone-off"
                                                                     update="@form" process="@this pmpPrincipalAtendimento"
                                                                     actionListener="#{fichaAtendimentoSacBean.encerrarAtendimento()}"
                                                                     styleClass="ui-button-danger border-round-lg font-bold shadow-1"
                                                                     title="Encerrar a ligação">
                                                        <p:confirm header="Confirmar encerramento"
                                                                   message="Deseja realmente encerrar o atendimento?"
                                                                   icon="pi pi-exclamation-triangle"/>
                                                    </p:commandButton>
                                                </div>

                                            </div>

                                            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" responsive="true" width="350">
                                                <p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no ui-button-flat"/>
                                                <p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes ui-button-danger"/>
                                            </p:confirmDialog>

                                        </div>
                                    </div>
                                    <!--INFORMACOES TMO-->
                                    <div class="grid mb-4">
                                        <div class="col-12 md:col-3">

                                            <div class="border-round-xl border-1 border-red-200 p-4 shadow-1"
                                                 style="background: linear-gradient(to bottom right, #fef2f2, #fee2e2);">

                                                <div class="flex align-items-center gap-3">

                                                    <div class="flex align-items-center justify-content-center border-round bg-red-100 flex-shrink-0"
                                                         style="width: 3.5rem; height: 3.5rem;">
                                                        <i class="pi pi-clock text-red-500 text-2xl"></i>
                                                    </div>

                                                    <div class="flex flex-column">
                                                        <span class="text-red-900 font-medium text-sm mb-1">Tempo de Atendimento (TMA)</span>

                                                        <div id="cronometroTma" class="text-2xl font-bold text-red-800">
                                                            00:00:00
                                                        </div>

                                                        <h:inputHidden id="inicioMillis"
                                                                       value="#{fichaAtendimentoSacBean.inicioAtendimentoMillis}"
                                                                       disabled="true"/>
                                                    </div>

                                                </div>
                                            </div>

                                        </div>
                                        <div class="col-12 md:col-3">
                                            <div class="border-round-xl border-1 border-green-200 p-4 shadow-1 h-full"
                                                 style="background: linear-gradient(to bottom right, #f0fdf4, #dcfce7);">

                                                <div class="flex align-items-center gap-3">
                                                    <div class="flex align-items-center justify-content-center border-round bg-green-100 flex-shrink-0"
                                                         style="width: 3.5rem; height: 3.5rem;">
                                                        <i class="pi pi-stopwatch text-green-600 text-2xl"></i>
                                                    </div>

                                                    <div class="flex flex-column">
                                                        <span class="text-green-900 font-medium text-sm mb-1">TME Atual</span>
                                                        <div class="text-2xl font-bold text-green-800">02:35</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12 md:col-3">
                                            <div class="border-round-xl border-1 border-orange-200 p-4 shadow-1 h-full"
                                                 style="background: linear-gradient(to bottom right, #fff7ed, #ffedd5);">

                                                <div class="flex align-items-center gap-3">
                                                    <div class="flex align-items-center justify-content-center border-round bg-orange-100 flex-shrink-0"
                                                         style="width: 3.5rem; height: 3.5rem;">
                                                        <i class="pi pi-phone text-orange-600 text-2xl"></i>
                                                    </div>

                                                    <div class="flex flex-column">
                                                        <span class="text-orange-900 font-medium text-sm mb-1">Contatos Anteriores</span>
                                                        <div class="text-2xl font-bold text-orange-800">#{fichaAtendimentoSacBean.quantidadeAtendimento}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12 md:col-3">
                                            <div class="border-round-xl border-1 border-yellow-200 p-4 shadow-1 h-full"
                                                 style="background: linear-gradient(to bottom right, #fefce8, #fef9c3);">

                                                <div class="flex align-items-center gap-3">
                                                    <div class="flex align-items-center justify-content-center border-round bg-yellow-100 flex-shrink-0"
                                                         style="width: 3.5rem; height: 3.5rem;">
                                                        <i class="pi pi-check-circle text-yellow-600 text-2xl"></i>
                                                    </div>

                                                    <div class="flex flex-column">
                                                        <span class="text-yellow-900 font-medium text-sm mb-1">FCR</span>

                                                        <span class="px-3 py-1 border-round text-white font-bold text-sm shadow-1 w-min white-space-nowrap"
                                                              style="background-color: #d97706;">
                    Não
                </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- FIM INFORMACOES TMO-->
                                    <div class="grid">

                                        <h:panelGroup styleClass="col-12 lg:col-4" layout="block" id="pnpDadosCliente">

                                            <p:card styleClass="shadow-2">

                                                <f:facet name="title">
                                                    <div class="flex justify-content-between align-items-center flex-wrap">
                                                        <div class="flex align-items-center gap-3">
                                                            <div>
                                                                <span class="text-xl font-medium text-900">Dados do Cliente</span>
                                                                <p class="text-sm text-gray-500 m-0">Informações cadastrais</p>
                                                            </div>

                                                            <h:panelGroup rendered="#{fichaAtendimentoSacBean.cliente.tipoClienteEnum ne 'CLIENTE'}"
                                                                          styleClass="inline-flex align-items-center border-round-2xl px-3 py-1 font-bold text-xs #{fichaAtendimentoSacBean.cliente.tipoClienteEnum.colorCss}">
                                                                <i class="#{fichaAtendimentoSacBean.cliente.tipoClienteEnum.icon} mr-2"/>
                                                                <h:outputText value="#{fichaAtendimentoSacBean.cliente.tipoClienteEnum.descricao}"/>
                                                            </h:panelGroup>
                                                        </div>

                                                        <p:commandButton value="Editar" icon="pi pi-pencil"
                                                                         oncomplete="PF('dlgEditarDadosCadastrais').show();"
                                                                         title="Editar dados cadastrais" process="@this"
                                                                         actionListener="#{fichaAtendimentoSacBean.editarDadosCadastrais()}"
                                                                         styleClass="ui-button-secondary ui-button-outlined ui-button-sm"/>
                                                    </div>
                                                </f:facet>

                                                <div class="flex flex-column gap-3 mt-2">

                                                    <div class="field m-0">
                                                        <p:outputLabel for="txtNome" value="Nome Completo" styleClass="font-semibold text-900 block mb-1"/>
                                                        <div class="flex align-items-stretch border-1 border-300 border-round bg-white overflow-hidden">
                                                            <div class="bg-gray-50 px-3 flex align-items-center justify-content-center border-right-1 border-300">
                                                                <i class="pi pi-user text-600"/>
                                                            </div>
                                                            <div class="flex-1">
                                                                <p:inputText id="txtNome" readonly="true"
                                                                             value="#{fichaAtendimentoSacBean.cliente.nome}"
                                                                             styleClass="w-full border-none shadow-none bg-transparent text-900"/>
                                                            </div>
                                                            <p:commandButton icon="pi pi-copy" title="Copiar" type="button"
                                                                             onclick="copiarTexto('#{fichaAtendimentoSacBean.cliente.nome}'); return false;"
                                                                             styleClass="ui-button-flat ui-button-secondary text-500 rounded-none h-full hover:bg-gray-100 px-3"/>
                                                        </div>
                                                    </div>

                                                    <div class="formgrid grid m-0">
                                                        <div class="field col-12 md:col-6 pl-0 pr-0 md:pr-2 m-0">
                                                            <p:outputLabel for="txtCpf" value="CPF" styleClass="font-semibold text-900 block mb-1"/>
                                                            <div class="flex align-items-stretch border-1 border-300 border-round bg-white overflow-hidden">
                                                                <div class="bg-gray-50 px-3 flex align-items-center justify-content-center border-right-1 border-300">
                                                                    <i class="pi pi-id-card text-600"/>
                                                                </div>
                                                                <div class="flex-1">
                                                                    <p:inputText id="txtCpf" readonly="true"
                                                                                 value="#{fichaAtendimentoSacBean.cliente.cpf}"
                                                                                 styleClass="w-full border-none shadow-none bg-transparent text-900"/>
                                                                </div>
                                                                <p:commandButton icon="pi pi-copy" title="Copiar" type="button"
                                                                                 onclick="copiarTexto('#{fichaAtendimentoSacBean.cliente.cpf}'); return false;"
                                                                                 styleClass="ui-button-flat ui-button-secondary text-500 rounded-none h-full hover:bg-gray-100 px-3"/>
                                                            </div>
                                                        </div>

                                                        <div class="field col-12 md:col-6 pr-0 pl-0 md:pl-2 m-0 mt-3 md:mt-0">
                                                            <p:outputLabel for="txtDataNascimento" value="Data Nascimento" styleClass="font-semibold text-900 block mb-1"/>
                                                            <div class="flex align-items-stretch border-1 border-300 border-round bg-white overflow-hidden">
                                                                <div class="bg-gray-50 px-3 flex align-items-center justify-content-center border-right-1 border-300">
                                                                    <i class="pi pi-calendar text-600"/>
                                                                </div>
                                                                <div class="flex-1">
                                                                    <p:inputText id="txtDataNascimento" readonly="true"
                                                                                 value="#{fichaAtendimentoSacBean.cliente.dataNascimentoFormatado}"
                                                                                 styleClass="w-full border-none shadow-none bg-transparent text-900"/>
                                                                </div>
                                                                <p:commandButton icon="pi pi-copy" title="Copiar" type="button"
                                                                                 onclick="copiarTexto('#{fichaAtendimentoSacBean.cliente.dataNascimentoFormatado}'); return false;"
                                                                                 styleClass="ui-button-flat ui-button-secondary text-500 rounded-none h-full hover:bg-gray-100 px-3"/>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="field m-0">
                                                        <p:outputLabel for="txtNomeMae" value="Nome da Mãe" styleClass="font-semibold text-900 block mb-1"/>
                                                        <div class="flex align-items-stretch border-1 border-300 border-round bg-white overflow-hidden">
                                                            <div class="bg-gray-50 px-3 flex align-items-center justify-content-center border-right-1 border-300">
                                                                <i class="pi pi-heart text-600"/>
                                                            </div>
                                                            <div class="flex-1">
                                                                <p:inputText id="txtNomeMae" readonly="true"
                                                                             value="#{fichaAtendimentoSacBean.cliente.nomeMae}"
                                                                             styleClass="w-full border-none shadow-none bg-transparent text-900"/>
                                                            </div>
                                                            <p:commandButton icon="pi pi-copy" title="Copiar" type="button"
                                                                             onclick="copiarTexto('#{fichaAtendimentoSacBean.cliente.nomeMae}'); return false;"
                                                                             styleClass="ui-button-flat ui-button-secondary text-500 rounded-none h-full hover:bg-gray-100 px-3"/>
                                                        </div>
                                                    </div>

                                                    <div class="field m-0">
                                                        <p:outputLabel for="txtNomePai" value="Nome do Pai" styleClass="font-semibold text-900 block mb-1"/>
                                                        <div class="flex align-items-stretch border-1 border-300 border-round bg-white overflow-hidden">
                                                            <div class="bg-gray-50 px-3 flex align-items-center justify-content-center border-right-1 border-300">
                                                                <i class="pi pi-user text-600"/>
                                                            </div>
                                                            <div class="flex-1">
                                                                <p:inputText id="txtNomePai" readonly="true"
                                                                             value="#{fichaAtendimentoSacBean.cliente.nomePai}"
                                                                             styleClass="w-full border-none shadow-none bg-transparent text-900"/>
                                                            </div>
                                                            <p:commandButton icon="pi pi-copy" title="Copiar" type="button"
                                                                             onclick="copiarTexto('#{fichaAtendimentoSacBean.cliente.nomePai}'); return false;"
                                                                             styleClass="ui-button-flat ui-button-secondary text-500 rounded-none h-full hover:bg-gray-100 px-3"/>
                                                        </div>
                                                    </div>

                                                    <div class="field m-0">
                                                        <p:outputLabel value="Telefone" styleClass="font-semibold text-900 block mb-1"/>
                                                        <div class="flex align-items-stretch border-1 border-300 border-round bg-white overflow-hidden">
                                                            <div class="bg-gray-50 px-3 flex align-items-center justify-content-center border-right-1 border-300">
                                                                <i class="pi pi-phone text-600"/>
                                                            </div>
                                                            <div class="flex-1 flex align-items-center px-3">
                                                                <h:outputText value="#{fichaAtendimentoSacBean.cliente.telefoneResumido}" styleClass="text-900"/>
                                                            </div>
                                                            <p:commandButton icon="pi pi-copy" title="Copiar" type="button"
                                                                             onclick="copiarTexto('#{fichaAtendimentoSacBean.cliente.primeiroTelefone}'); return false;"
                                                                             styleClass="ui-button-flat ui-button-secondary text-500 rounded-none h-full hover:bg-gray-100 px-3"/>
                                                        </div>
                                                    </div>

                                                    <div class="field m-0">
                                                        <p:outputLabel value="Endereço" styleClass="font-semibold text-900 block mb-1"/>
                                                        <div class="flex align-items-stretch border-1 border-300 border-round bg-white overflow-hidden">
                                                            <div class="bg-gray-50 w-3rem flex align-items-start justify-content-center pt-3 border-right-1 border-300">
                                                                <i class="pi pi-map-marker text-600"/>
                                                            </div>
                                                            <div class="flex-1 p-3">
                                                                <h:outputText value="#{fichaAtendimentoSacBean.cliente.enderecoResumido}"
                                                                              styleClass="text-900"
                                                                              style="white-space: pre-wrap; word-break: break-word;"/>
                                                            </div>
                                                            <div class="flex flex-column justify-content-start pt-2 pr-2 bg-gray-50 border-left-1 border-300">
                                                                <p:commandButton icon="pi pi-copy" title="Copiar" type="button"
                                                                                 onclick="copiarTexto('#{fichaAtendimentoSacBean.cliente.enderecoResumido}'); return false;"
                                                                                 styleClass="ui-button-flat ui-button-secondary text-500 rounded-circle hover:bg-gray-200"/>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>

                                                <script>
                                                    function copiarTexto(texto) {
                                                        if (!texto) return;
                                                        navigator.clipboard.writeText(texto).then(function() {
                                                            // Optional: You can trigger a PrimeFaces growl here if you have a widgetVar
                                                            // PF('growl').renderMessage({summary:'Sucesso', detail:'Texto copiado!', severity:'info'});
                                                            console.log('Copiado: ' + texto);
                                                        }, function(err) {
                                                            console.error('Erro ao copiar: ', err);
                                                        });
                                                    }
                                                </script>

                                            </p:card>

                                            <div class="mt-3">
                                                <ui:include src="/pages/atendimento/componetHistorico.xhtml"/>
                                            </div>
                                        </h:panelGroup>

                                        <div class="col-12 lg:col-8">

                                            <p:card styleClass="shadow-2 mb-3">
                                                <f:facet name="title">Limites do Cartão</f:facet>
                                                <div class="grid mt-2">
                                                    <div class="col-12 md:col-6 lg:col-3">
                                                        <div class="p-3 border-round bg-purple-50">
                                                            <small class="text-600">Limite à Vista</small>
                                                            <div class="limite-valor">#{fichaAtendimentoSacBean.atendimento.limitFormatado}</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-12 md:col-6 lg:col-3">
                                                        <div class="p-3 border-round bg-green-50">
                                                            <small class="text-600">Disponível Vista</small>
                                                            <div class="limite-valor">#{fichaAtendimentoSacBean.atendimento.limitDisponivelFormatado}</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-12 md:col-6 lg:col-3">
                                                        <div class="p-3 border-round bg-cyan-50">
                                                            <small class="text-600">Limite Saque</small>
                                                            <div class="limite-valor">#{fichaAtendimentoSacBean.atendimento.limiteSaqueFormatado}</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-12 md:col-6 lg:col-3">
                                                        <div class="p-3 border-round bg-blue-50">
                                                            <small class="text-600">Disponível Saque</small>
                                                            <div class="limite-valor">#{fichaAtendimentoSacBean.atendimento.limiteSaqueDisponivel}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </p:card>

                                            <!--  PAINEL PARA CLASSIFICAR O ATENDIMENTo - PRE ATENDIMENTO-->
                                            <p:card styleClass="shadow-2 " id="cardClassificacao"
                                                    rendered="#{!fichaAtendimentoSacBean.atendimentoIniciado}">

                                                <f:facet name="title">
                                                    <div class="flex align-items-center justify-content-between">
                                                        <div class="flex align-items-center">
                                                            <i class="pi pi-list mr-2 text-primary"/>
                                                            <span class="text-xl font-bold">Classificação do Atendimento</span>
                                                        </div>
                                                        <p:commandButton icon="pi pi-refresh"
                                                                         title="Reiniciar Classificação"
                                                                         actionListener="#{fichaAtendimentoSacBean.resetClassificacao()}"
                                                                         update="cardClassificacao" process="@this"
                                                                         rendered="#{fichaAtendimentoSacBean.stepClassificacao gt 0}"
                                                                         styleClass="ui-button-flat ui-button-secondary ui-button-rounded ui-button-sm"/>
                                                    </div>
                                                </f:facet>

                                                <h:panelGroup layout="block"
                                                              styleClass="mb-4 fadein animation-duration-300"
                                                              rendered="#{fichaAtendimentoSacBean.stepClassificacao gt 0}">
                                                    <div class="flex align-items-center text-lg">
                                                        <p:commandLink
                                                                actionListener="#{fichaAtendimentoSacBean.setStepClassificacao(0)}"
                                                                update="cardClassificacao" process="@this"
                                                                styleClass="no-underline text-700 hover:text-primary font-medium transition-colors">
                                                            <h:outputText
                                                                    value="#{fichaAtendimentoSacBean.motivoSelecionado.descricao}"/>
                                                        </p:commandLink>

                                                        <i class="pi pi-angle-right text-gray-400 mx-2"/>

                                                        <h:panelGroup
                                                                rendered="#{fichaAtendimentoSacBean.stepClassificacao ge 2}">
                                                            <p:commandLink
                                                                    actionListener="#{fichaAtendimentoSacBean.setStepClassificacao(1)}"
                                                                    update="cardClassificacao" process="@this"
                                                                    styleClass="no-underline text-700 hover:text-primary font-medium transition-colors">
                                                                <h:outputText
                                                                        value="#{fichaAtendimentoSacBean.subMotivoSelecionado.descricao}"/>
                                                            </p:commandLink>
                                                            <i class="pi pi-angle-right text-gray-400 mx-2"/>
                                                        </h:panelGroup>

                                                        <span class="text-primary font-bold">
                                                            #{fichaAtendimentoSacBean.stepClassificacao eq 1 ? 'Selecione o Submotivo' : 'Confirmação'}
                                                        </span>
                                                    </div>
                                                </h:panelGroup>

                                                <h:panelGroup
                                                        rendered="#{fichaAtendimentoSacBean.stepClassificacao eq 0}"
                                                        styleClass="fadein">
                                                    <p class="text-600 mb-3">Selecione o motivo principal do atendimento:</p>
                                                    <div class="flex flex-wrap gap-2">
                                                        <ui:repeat value="#{fichaAtendimentoSacBean.listMotivo}"
                                                                   var="motivo">
                                                            <p:commandButton value="#{motivo.descricao}"
                                                                             actionListener="#{fichaAtendimentoSacBean.onChangeMotivo(motivo)}"
                                                                             update="cardClassificacao" process="@this"
                                                                             styleClass="ui-button-outlined ui-button-secondary border-round-3xl hover:shadow-2"
                                                                             style="border-color: #{motivo.cor}; color: #{motivo.cor}; background-color: white;"
                                                                             onmouseover="this.style.backgroundColor='#{motivo.cor}10'"
                                                                             onmouseout="this.style.backgroundColor='white'"/>
                                                        </ui:repeat>
                                                    </div>
                                                </h:panelGroup>

                                                <h:panelGroup
                                                        rendered="#{fichaAtendimentoSacBean.stepClassificacao eq 1}"
                                                        styleClass="fadein animation-duration-300">
                                                    <div class="flex align-items-center mb-4 p-3 bg-bluegray-50 border-round-lg border-1 border-bluegray-100">
                                                        <div class="mr-3 flex flex-column align-items-center">
                                                            <span class="text-xs text-500 font-bold uppercase mb-1">Motivo Atual</span>
                                                            <div class="w-2rem h-2rem border-circle flex align-items-center justify-content-center shadow-1"
                                                                 style="background-color: #{fichaAtendimentoSacBean.motivoSelecionado.cor}">
                                                                <i class="pi pi-tag text-white text-xs"></i>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <h3 class="m-0 text-700 text-lg">#{fichaAtendimentoSacBean.motivoSelecionado.descricao}</h3>
                                                            <span class="text-500 text-sm">Selecione uma das opções abaixo para detalhar este atendimento.</span>
                                                        </div>
                                                    </div>

                                                    <h:panelGroup
                                                            rendered="#{not empty fichaAtendimentoSacBean.listSubMotivo}">

                                                        <div class="flex flex-wrap gap-3">

                                                            <ui:repeat value="#{fichaAtendimentoSacBean.listSubMotivo}"
                                                                       var="sub">
                                                                <p:commandButton value="#{sub.descricao}"
                                                                                 actionListener="#{fichaAtendimentoSacBean.onSelecionarSubMotivo(sub)}"
                                                                                 update="cardClassificacao"
                                                                                 process="@this"
                                                                                 icon="pi pi-angle-right"
                                                                                 iconPos="right"
                                                                                 styleClass="ui-button-outlined ui-button-secondary border-round-2xl surface-card transition-all transition-duration-200 hover:shadow-3 h-3rem px-3"
                                                                                 style="border-color: #{sub.cor}; color: #{sub.cor}; font-weight: 600;"
                                                                                 onmouseover="this.style.backgroundColor='#{sub.cor}15'"
                                                                                 onmouseout="this.style.backgroundColor='white'"/>
                                                            </ui:repeat>

                                                        </div>

                                                    </h:panelGroup>

                                                    <h:panelGroup
                                                            rendered="#{empty fichaAtendimentoSacBean.listSubMotivo}"
                                                            layout="block"
                                                            styleClass="flex flex-column align-items-center justify-content-center p-5 surface-50 border-round-xl border-dashed border-1 border-300">

                                                        <div class="bg-orange-100 border-circle p-3 mb-3">
                                                            <i class="pi pi-folder-open text-orange-500 text-4xl"></i>
                                                        </div>

                                                        <span class="text-900 font-bold text-lg mb-2">Nenhum detalhe encontrado</span>

                                                        <span class="text-600 text-center mb-4"
                                                              style="max-width: 300px;">
                                                            Não existem submotivos cadastrados para "<strong>#{fichaAtendimentoSacBean.motivoSelecionado.descricao}</strong>".

                                                        </span>

                                                        <p:commandButton value="Usar apenas o Motivo Principal"
                                                                         icon="pi pi-check"
                                                                         actionListener="#{fichaAtendimentoSacBean.onSelecionarSubMotivo(null)}"
                                                                         update="cardClassificacao"
                                                                         styleClass="ui-button-outlined ui-button-warning mb-2"/>
                                                    </h:panelGroup>

                                                    <p:divider styleClass="mt-5 mb-3"/>
                                                    <div class="flex justify-content-start">
                                                        <p:commandButton value="Voltar e Trocar Motivo"
                                                                         icon="pi pi-arrow-left"
                                                                         actionListener="#{fichaAtendimentoSacBean.setStepClassificacao(0)}"
                                                                         update="cardClassificacao" process="@this"
                                                                         styleClass="ui-button-text ui-button-secondary hover:text-900"/>
                                                    </div>
                                                </h:panelGroup>

                                                <h:panelGroup
                                                        rendered="#{fichaAtendimentoSacBean.stepClassificacao eq 2}"
                                                        styleClass="fadein">
                                                    <div class="mb-6 p-4 bg-blue-50 border-round border-1 border-blue-100">
                                                        <h4 class="text-sm text-gray-900 mb-3">Resumo da Classificação:</h4>
                                                        <div class="grid grid-nogutter">
                                                            <div class="col-12 mb-1">
                                                                <span class="text-gray-600 mr-2">Motivo:</span>
                                                                <span class="text-gray-900 text-800">#{fichaAtendimentoSacBean.motivoSelecionado.descricao}</span>
                                                            </div>
                                                            <div class="col-12">
                                                                <span class="text-gray-600  mr-2">Submotivo:</span>
                                                                <span class="text-gray-900 text-800">#{fichaAtendimentoSacBean.subMotivoSelecionado.descricao}</span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <h:panelGroup
                                                            rendered="#{fichaAtendimentoSacBean.subMotivoSelecionado.envarN2}">
                                                        <div class="surface-ground border-round p-3 mb-3 border-1 border-yellow-200 bg-yellow-50 flex align-items-start">
                                                            <p:selectBooleanCheckbox id="checkN2"
                                                                                     value="#{fichaAtendimentoSacBean.atendimento.enviarN2}"
                                                                                     styleClass="mr-2 pt-1"/>
                                                            <div>
                                                                <p:outputLabel for="checkN2"
                                                                               value="Derivar para N2 - Cartões"
                                                                               styleClass="font-bold text-900 block"/>
                                                                <small class="text-600">Marque esta opção se deseja derivar o atendimento para análise N2.</small>
                                                            </div>
                                                        </div>
                                                    </h:panelGroup>

                                                    <div class="field mt-3">

                                                        <p:outputLabel for="obs" value="Observações Adicionais:"
                                                                       styleClass="font-bold text-700 mb-2 block">

                                                            <span class="text-red-500">*</span>

                                                        </p:outputLabel>

                                                        <p:inputTextarea id="obs"
                                                                         value="#{fichaAtendimentoSacBean.atendimento.observacaoAdicional}"
                                                                         rows="3" styleClass="w-full"
                                                                         placeholder="Digite as observações do atendimento (campo obrigatório)..."
                                                                         required="true" spellcheck="true" lang="pt-BR"
                                                                         requiredMessage="A observação é obrigatória."/>
                                                        <small class="text-500">Obrigatório: Registre os detalhes importantes da conversa com o cliente.</small>

                                                    </div>

                                                    <div class="flex justify-content-between mt-4">

                                                        <p:commandButton value="Voltar" icon="pi pi-arrow-left"
                                                                         actionListener="#{fichaAtendimentoSacBean.setStepClassificacao(1)}"
                                                                         update="cardClassificacao" process="@this"
                                                                         styleClass="ui-button-outlined ui-button-secondary w-4"/>

                                                        <p:commandButton value="Iniciar Atendimento" icon="pi pi-check"
                                                                         update="grl formConteudo"
                                                                         actionListener="#{fichaAtendimentoSacBean.classificarAtendimento()}"
                                                                         ignoreAutoUpdate="@form"
                                                                         process="cardClassificacao"
                                                                         styleClass="ui-button-primary w-6 bg-bluegray-700 border-bluegray-700"/>
                                                    </div>

                                                </h:panelGroup>

                                            </p:card>

                                            <!--  PAINEL REGISTRAR ATENDIMENTo-->
                                            <h:panelGroup id="panelOperacional" layout="block"
                                                          rendered="#{fichaAtendimentoSacBean.atendimentoIniciado}"
                                                          styleClass="fadein animation-duration-500">

                                                <div class="card shadow-2 border-round-xl p-0 bg-white overflow-hidden">

                                                    <h:panelGroup
                                                            styleClass="flex bg-gray-100 border-bottom-1 border-300"
                                                            layout="block" id="pnpAbasRegistrarAtendimento">

                                                        <ui:repeat
                                                                value="#{fichaAtendimentoSacBean.atendimento.subMotivo.listTipoMetodosMotivos}"
                                                                var="metodos">

                                                            <p:commandLink
                                                                    actionListener="#{fichaAtendimentoSacBean.trocarAba(metodos.name())}"
                                                                    update="panelOperacional" process="@this"
                                                                    styleClass="flex-1 p-3 text-center no-underline transition-colors border-right-1 border-200 #{fichaAtendimentoSacBean.abaAtiva eq metodos.name() ? 'font-bold text-gray-800 bg-white border-top-2 border-primary' : 'font-medium text-gray-600 hover:bg-gray-200'}">
                                                                #{metodos.descricao}
                                                            </p:commandLink>

                                                        </ui:repeat>

                                                        <!--  <p:commandLink
                                                                  actionListener="#{fichaAtendimentoSacBean.trocarAba('CARTAO')}"
                                                                  update="panelOperacional" process="@this"
                                                                  styleClass="flex-1 p-3 text-center no-underline transition-colors border-right-1 border-200 #{fichaAtendimentoSacBean.abaAtiva eq 'CARTAO' ? 'font-bold text-gray-800 bg-white border-top-2 border-primary' : 'font-medium text-gray-600 hover:bg-gray-200'}">
                                                              Cartão
                                                          </p:commandLink>

                                                          <p:commandLink
                                                                  actionListener="#{fichaAtendimentoSacBean.trocarAba('LIMITE')}"
                                                                  update="panelOperacional" process="@this"
                                                                  styleClass="flex-1 p-3 text-center no-underline transition-colors border-right-1 border-200 #{fichaAtendimentoSacBean.abaAtiva eq 'LIMITE' ? 'font-bold text-gray-800 bg-white border-top-2 border-primary' : 'font-medium text-gray-600 hover:bg-gray-200'}">
                                                              Limite
                                                          </p:commandLink>

                                                          <p:commandLink
                                                                  actionListener="#{fichaAtendimentoSacBean.trocarAba('SENHA')}"
                                                                  update="panelOperacional" process="@this"
                                                                  styleClass="flex-1 p-3 text-center no-underline transition-colors border-right-1 border-200 #{fichaAtendimentoSacBean.abaAtiva eq 'SENHA' ? 'font-bold text-gray-800 bg-white border-top-2 border-primary' : 'font-medium text-gray-600 hover:bg-gray-200'}">
                                                              Senha
                                                          </p:commandLink>

                                                          <p:commandLink
                                                                  actionListener="#{fichaAtendimentoSacBean.trocarAba('2VIA')}"
                                                                  update="panelOperacional" process="@this"
                                                                  styleClass="flex-1 p-3 text-center no-underline transition-colors border-right-1 border-200 #{fichaAtendimentoSacBean.abaAtiva eq '2VIA' ? 'font-bold text-gray-800 bg-white border-top-2 border-primary' : 'font-medium text-gray-600 hover:bg-gray-200'}">
                                                              2ª Via
                                                          </p:commandLink>

                                                          <p:commandLink
                                                                  actionListener="#{fichaAtendimentoSacBean.trocarAba('NOTAS')}"
                                                                  update="panelOperacional" process="@this"
                                                                  styleClass="flex-1 p-3 text-center no-underline transition-colors #{fichaAtendimentoSacBean.abaAtiva eq 'NOTAS' ? 'font-bold text-gray-800 bg-white border-top-2 border-primary' : 'font-medium text-gray-600 hover:bg-gray-200'}">
                                                              Notas
                                                          </p:commandLink>
  -->

                                                    </h:panelGroup>

                                                    <div class="p-4" style="min-height: 400px;">

                                                        <h:panelGroup
                                                                rendered="#{fichaAtendimentoSacBean.abaAtiva eq 'LIMITE'}"
                                                                styleClass="fadein animation-duration-300">

                                                            <div class="flex align-items-center mb-1">
                                                                <i class="pi pi-chart-line text-primary text-xl mr-2"></i>
                                                                <h2 class="text-xl text-900 font-bold m-0">Gerenciamento de Limite</h2>
                                                            </div>
                                                            <span class="text-600 text-sm block mb-4">Informações e solicitações de limite</span>

                                                            <div class="grid mb-2">
                                                                <div class="col-4">
                                                                    <div class="surface-50 border-round p-3 text-center h-full border-1 border-200">
                                                                        <span class="text-blue-600 font-medium text-sm block mb-1">Limite Total</span>
                                                                        <span class="text-blue-900 text-2xl font-bold">
                                                                                <p:inputText
                                                                                        value="#{fichaAtendimentoSacBean.cartaoCreditoSelecionado.limiteTotal}"
                                                                                        styleClass="text-blue-900 text-2xl font-bold">
                                                                                        <f:convertNumber type="currency"
                                                                                                         currencySymbol="R$"
                                                                                                         locale="pt_BR"/>
                                                                                </p:inputText>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="col-4">
                                                                    <div class="surface-50 border-round p-3 text-center h-full border-1 border-200">
                                                                        <span class="text-green-600 font-medium text-sm block mb-1">Disponível</span>
                                                                        <span class="text-green-900 text-2xl font-bold">
                                                                              <p:inputText
                                                                                      value="#{fichaAtendimentoSacBean.cartaoCreditoSelecionado.limiteDisponivel}"
                                                                                      styleClass="text-blue-900 text-2xl font-bold">
                                                                                        <f:convertNumber type="currency"
                                                                                                         currencySymbol="R$"
                                                                                                         locale="pt_BR"/>
                                                                                </p:inputText>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div class="col-4">
                                                                    <div class="surface-50 border-round p-3 text-center h-full border-1 border-200">
                                                                        <span class="text-purple-600 font-medium text-sm block mb-1">Emergencial</span>
                                                                        <span class="text-purple-900 text-2xl font-bold">
                                                                              <p:inputText
                                                                                      value="#{fichaAtendimentoSacBean.cartaoCreditoSelecionado.limiteEmergencial}"
                                                                                      styleClass="text-blue-900 text-2xl font-bold">
                                                                                        <f:convertNumber type="currency"
                                                                                                         currencySymbol="R$"
                                                                                                         locale="pt_BR"/>
                                                                                </p:inputText>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="mb-4">
                                                                <div class="flex justify-content-between mb-1">
                                                                    <span class="text-700 text-sm font-bold">Utilização do Limite</span>
                                                                    <span class="text-primary font-bold text-sm">
                                                                            #{fichaAtendimentoSacBean.cartaoCreditoSelecionado.percentualUtilizadoFormatado}
                                                                    </span>
                                                                </div>
                                                                <div class="w-full bg-gray-200 border-round-xl h-1rem overflow-hidden">
                                                                    <div class="bg-green-500 h-full"
                                                                         style="width: #{fichaAtendimentoSacBean.cartaoCreditoSelecionado.percentualUtilizadoFormatadoCss}"></div>
                                                                </div>
                                                            </div>

                                                            <div class="surface-overlay border-1 border-blue-200 border-round p-3 mb-4 bg-blue-50 flex align-items-start">
                                                                <i class="pi pi-info-circle text-blue-500 mr-2 mt-1"></i>
                                                                <span class="text-blue-900 text-sm line-height-3">
                                                                      Solicitações de aumento de limite passam por análise de crédito e podem levar até 48h úteis para aprovação.
                                                              </span>
                                                            </div>

                                                            <div class="ui-fluid formgrid grid">
                                                                <div class="field col-12">
                                                                    <p:outputLabel for="novoLimite"
                                                                                   value="Novo Limite Solicitado (R$)"
                                                                                   styleClass="font-bold text-900 mb-2 block"/>
                                                                    <p:inputNumber id="novoLimite"
                                                                                   value="#{fichaAtendimentoSacBean.novoLimiteSolicitado}"
                                                                                   symbol="R$ " symbolPosition="p"
                                                                                   decimalSeparator=","
                                                                                   thousandSeparator="."
                                                                                   placeholder="Ex: 20000"
                                                                                   styleClass="w-full"/>
                                                                </div>

                                                                <div class="field col-12">
                                                                    <p:outputLabel for="motivoLimite"
                                                                                   value="Motivo da Solicitação"
                                                                                   styleClass="font-bold text-900 mb-2 block"/>
                                                                    <p:inputTextarea id="motivoLimite"
                                                                                     value="#{fichaAtendimentoSacBean.motivoSolicitacaoLimite}"
                                                                                     rows="3" spellcheck="true" lang="pt-BR"
                                                                                     placeholder="Descreva o motivo apresentado pelo cliente..."
                                                                                     styleClass="w-full"/>
                                                                </div>
                                                            </div>

                                                            <div class="mt-2">
                                                                <p:commandButton value="Registrar Solicitação"
                                                                                 icon="pi pi-save"
                                                                                 actionListener="#{fichaAtendimentoSacBean.registrarSolicitacaoLimite()}"
                                                                                 update="panelOperacional grl"
                                                                                 styleClass="w-full ui-button-secondary bg-bluegray-700 border-bluegray-700 font-bold py-3 shadow-2 hover:bg-bluegray-800"/>
                                                            </div>

                                                        </h:panelGroup>

                                                        <h:panelGroup
                                                                rendered="#{fichaAtendimentoSacBean.abaAtiva eq 'CARTAO'}"
                                                                styleClass="fadein animation-duration-300">
                                                            <div class="flex align-items-center mb-4">
                                                                <i class="pi pi-credit-card text-primary text-xl mr-2"></i>
                                                                <h2 class="text-xl text-900 font-bold m-0">Informações do Cartão</h2>
                                                            </div>

                                                            <h:panelGroup styleClass="ui-fluid formgrid grid"
                                                                          layout="block"
                                                                          rendered="#{not empty fichaAtendimentoSacBean.cliente.cartaoCreditoPrincipal}">
                                                                <div class="field col-12 md:col-6">
                                                                    <p:outputLabel value="Número do Cartão"
                                                                                   styleClass="text-500 font-medium"/>
                                                                    <p:inputText
                                                                            value="#{fichaAtendimentoSacBean.cliente.cartaoCreditoPrincipal.getNumeroMascarado()}"
                                                                            readonly="true"
                                                                            styleClass="bg-gray-50 text-900 font-bold border-round-lg"/>
                                                                </div>
                                                                <div class="field col-12 md:col-6">
                                                                    <p:outputLabel value="Bandeira"
                                                                                   styleClass="text-500 font-medium"/>
                                                                    <p:inputText
                                                                            value="#{fichaAtendimentoSacBean.cliente.cartaoCreditoPrincipal.bandeira}"
                                                                            readonly="true"
                                                                            styleClass="bg-gray-50 text-900 border-round-lg"/>
                                                                </div>
                                                                <div class="field col-12 md:col-6">
                                                                    <p:outputLabel value="Tipo"
                                                                                   styleClass="text-500 font-medium"/>
                                                                    <p:inputText
                                                                            value="#{fichaAtendimentoSacBean.cliente.cartaoCreditoPrincipal.tipo}"
                                                                            readonly="true"
                                                                            styleClass="bg-gray-50 text-900 border-round-lg"/>
                                                                </div>
                                                                <div class="field col-12 md:col-6">
                                                                    <p:outputLabel value="Validade"
                                                                                   styleClass="text-500 font-medium"/>
                                                                    <p:inputText
                                                                            value="#{fichaAtendimentoSacBean.cliente.cartaoCreditoPrincipal.validade}"
                                                                            readonly="true"
                                                                            styleClass="bg-gray-50 text-900 border-round-lg"/>
                                                                </div>
                                                                <div class="field col-12 md:col-6">
                                                                    <p:outputLabel value="Status"
                                                                                   styleClass="text-500 font-medium"/>
                                                                    <p:inputText
                                                                            value="#{fichaAtendimentoSacBean.cliente.cartaoCreditoPrincipal.status}"
                                                                            readonly="true"
                                                                            styleClass="bg-orange-50 text-orange-600 font-bold border-orange-200 border-round-lg"/>
                                                                </div>
                                                                <div class="field col-12 md:col-6">
                                                                    <p:outputLabel value="Cartão Adicional"
                                                                                   styleClass="text-500 font-medium"/>
                                                                    <p:inputText value="Não" readonly="true"
                                                                                 styleClass="bg-gray-50 text-900 border-round-lg"/>
                                                                </div>

                                                                <div class="col-12 mt-2">
                                                                    <p:outputLabel value="Ações Disponíveis"
                                                                                   styleClass="text-700 font-bold mb-2 block"/>
                                                                    <div class="flex flex-column gap-2">
                                                                        <p:commandButton value="Desbloquear Cartão"
                                                                                         icon="pi pi-lock-open"
                                                                                         styleClass="ui-button-outlined ui-button-success w-full border-round-lg hover:bg-green-50"/>
                                                                        <p:commandButton value="Cancelar Cartão"
                                                                                         icon="pi pi-times-circle"
                                                                                         styleClass="ui-button-outlined ui-button-danger w-full border-round-lg hover:bg-red-50"/>
                                                                    </div>
                                                                </div>
                                                            </h:panelGroup>

                                                            <h:panelGroup layout="block"
                                                                          rendered="#{ empty fichaAtendimentoSacBean.cliente.cartaoCreditoPrincipal}"
                                                                          styleClass="col-12">

                                                                <div class="flex flex-column align-items-center justify-content-center p-5 bg-white border-round-xl border-1 border-200 shadow-1 h-full">

                                                                    <div class="w-5rem h-5rem border-circle bg-bluegray-50 flex align-items-center justify-content-center mb-3">
                                                                        <i class="pi pi-credit-card text-bluegray-400 text-4xl"></i>
                                                                        <i class="pi pi-ban text-pink-500 text-xl absolute mb-4 ml-4 bg-white border-circle p-1"></i>
                                                                    </div>

                                                                    <span class="text-900 font-bold text-xl mb-2">Nenhum cartão encontrado</span>
                                                                    <p class="text-600 m-0 text-center line-height-3"
                                                                       style="max-width: 300px">
                                                                        Não foram localizados cartões de crédito ativos ou vinculados para o CPF deste cliente.
                                                                    </p>

                                                                    <div class="mt-4">
                                                                        <p:commandButton value="Atualizar Cadastro"

                                                                                         icon="pi pi-refresh"
                                                                                         styleClass="ui-button-outlined ui-button-secondary border-round-lg"/>
                                                                    </div>
                                                                </div>

                                                            </h:panelGroup>

                                                        </h:panelGroup>

                                                        <h:panelGroup
                                                                rendered="#{fichaAtendimentoSacBean.abaAtiva eq 'SENHA'}"
                                                                styleClass="fadein animation-duration-300">
                                                            <div class="flex align-items-center mb-4">
                                                                <i class="pi pi-lock text-primary text-xl mr-2"></i>
                                                                <h2 class="text-xl text-900 font-bold m-0">Redefinição de Senha</h2>
                                                            </div>

                                                            <p:outputLabel value="Opções de redefinição"
                                                                           styleClass="text-600 font-medium mb-2 block"/>

                                                            <div class="flex flex-column gap-3">
                                                                <div class="border-1 border-200 border-round-lg hover:shadow-1 transition-all bg-white">
                                                                    <p:commandLink
                                                                            styleClass="flex align-items-center p-3 no-underline text-900 hover:text-primary">
                                                                        <div class="bg-blue-50 border-circle w-3rem h-3rem flex align-items-center justify-content-center mr-3">
                                                                            <i class="pi pi-comment text-blue-600 text-lg"></i>
                                                                        </div>
                                                                        <div class="flex-1">
                                                                            <span class="font-bold block">Enviar código por SMS</span>
                                                                            <span class="text-500 text-sm">Para o número (11) 9****-4321</span>
                                                                        </div>
                                                                        <i class="pi pi-chevron-right text-400"></i>
                                                                    </p:commandLink>
                                                                </div>

                                                                <div class="border-1 border-200 border-round-lg hover:shadow-1 transition-all bg-white">
                                                                    <p:commandLink
                                                                            styleClass="flex align-items-center p-3 no-underline text-900 hover:text-primary">
                                                                        <div class="bg-blue-50 border-circle w-3rem h-3rem flex align-items-center justify-content-center mr-3">
                                                                            <i class="pi pi-envelope text-blue-600 text-lg"></i>
                                                                        </div>
                                                                        <div class="flex-1">
                                                                            <span class="font-bold block">Enviar código por E-mail</span>
                                                                            <span class="text-500 text-sm">Para joao.silva@****.com</span>
                                                                        </div>
                                                                        <i class="pi pi-chevron-right text-400"></i>
                                                                    </p:commandLink>
                                                                </div>

                                                                <div class="border-1 border-200 border-round-lg hover:shadow-1 transition-all bg-white">
                                                                    <p:commandLink
                                                                            styleClass="flex align-items-center p-3 no-underline text-900 hover:text-primary">
                                                                        <div class="bg-gray-100 border-circle w-3rem h-3rem flex align-items-center justify-content-center mr-3">
                                                                            <i class="pi pi-mobile text-700 text-lg"></i>
                                                                        </div>
                                                                        <div class="flex-1">
                                                                            <span class="font-bold block">Orientar redefinição via App</span>
                                                                            <span class="text-500 text-sm">Instruções passo-a-passo</span>
                                                                        </div>
                                                                        <i class="pi pi-chevron-right text-400"></i>
                                                                    </p:commandLink>
                                                                </div>
                                                            </div>

                                                            <div class="mt-4 p-3 bg-blue-50 border-round border-left-3 border-blue-500 flex align-items-start">
                                                                <i class="pi pi-info-circle text-blue-500 mr-2 mt-1"></i>
                                                                <span class="text-blue-900 text-sm line-height-3">
                                                                        Sempre confirmar a identidade do cliente antes de proceder com a redefinição de senha.
                                                                        Verifique as perguntas de segurança se necessário.
                                                                 </span>
                                                            </div>
                                                        </h:panelGroup>

                                                        <h:panelGroup
                                                                rendered="#{fichaAtendimentoSacBean.abaAtiva eq 'SEGUNDA_VIA'}"
                                                                styleClass="fadein animation-duration-300">

                                                            <div class="flex align-items-center mb-4">
                                                                <i class="pi pi-id-card text-primary text-xl mr-2"></i>
                                                                <h2 class="text-xl text-900 font-bold m-0">Solicitação de 2ª Via</h2>
                                                            </div>

                                                            <div class="grid formgrid ui-fluid">

                                                                <div class="col-12 md:col-6">

                                                                    <div class="field">
                                                                        <p:outputLabel for="selectMotivo2Via"
                                                                                       value="Qual o motivo da solicitação?"
                                                                                       styleClass="font-semibold text-700 mb-2 block"/>
                                                                        <p:selectOneMenu id="selectMotivo2Via"
                                                                                         value="#{fichaAtendimentoSacBean.motivoSolicitacaoSegundaViaCartao}"
                                                                                         autoWidth="false"
                                                                                         styleClass="w-full border-round-lg shadow-1">
                                                                            <f:selectItem
                                                                                    itemLabel="Selecione uma opção..."
                                                                                    itemValue="#{null}"
                                                                                    noSelectionOption="true"/>
                                                                            <f:selectItems
                                                                                    value="#{fichaAtendimentoSacBean.listMotivoSolicitacaoSegundaViaCartao}"
                                                                                    var="m"
                                                                                    itemLabel="#{m.descricao}"
                                                                                    itemValue="#{m}"/>
                                                                            <p:ajax update="panelInfo2Via"
                                                                                    process="@this"/>
                                                                        </p:selectOneMenu>
                                                                    </div>

                                                                    <div class="surface-card p-3 border-1 border-orange-200 bg-orange-50 border-round-lg flex align-items-start mt-4">
                                                                        <i class="pi pi-exclamation-triangle text-orange-500 mr-2 text-xl mt-1"></i>
                                                                        <div>
                                                                            <span class="font-bold text-orange-900 block mb-1">Atenção</span>
                                                                            <p class="text-orange-800 m-0 text-sm line-height-3">
                                                                                Ao confirmar a solicitação por
                                                                                <strong>Perda</strong> ou
                                                                                <strong>Roubo</strong>, o cartão atual será bloqueado preventivamente de imediato.
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                    <div class="mt-5 pt-3 border-top-1 border-200">

                                                                        <p:commandButton id="btnSolicitar2Via"
                                                                                         value="Confirmar Solicitação"
                                                                                         icon="pi pi-check"

                                                                                         update="grl panelOperacional"
                                                                                         process="@parent"
                                                                                         disabled="#{fichaAtendimentoSacBean.motivoSolicitacaoSegundaViaCartao eq null}"
                                                                                         styleClass="w-full ui-button-primary border-round-lg font-bold py-3 shadow-2 hover:shadow-4 transition-all"/>
                                                                    </div>
                                                                </div>


                                                                <div class="col-12 md:col-6">
                                                                    <h:panelGroup id="panelInfo2Via" layout="block"
                                                                                  styleClass="border-1 border-200 border-round-xl p-3 bg-gray-50 h-full">

                                                                        <span class="text-600 font-bold text-sm uppercase mb-3 block border-bottom-1 border-300 pb-2">Detalhes da Entrega</span>

                                                                        <div class="flex align-items-center mb-3">
                                                                            <div class="bg-white border-circle w-3rem h-3rem flex align-items-center justify-content-center shadow-1 mr-3 text-primary">
                                                                                <i class="pi pi-truck text-xl"></i>
                                                                            </div>
                                                                            <div>
                                                                                <span class="text-500 text-sm block">Estimativa de Entrega</span>
                                                                                <span class="text-900 font-bold text-xl">7 a 10 dias úteis</span>
                                                                            </div>
                                                                        </div>

                                                                        <div class="flex align-items-center mb-3">
                                                                            <div class="bg-white border-circle w-3rem h-3rem flex align-items-center justify-content-center shadow-1 mr-3 text-primary">
                                                                                <i class="pi pi-map-marker text-xl"></i>
                                                                            </div>
                                                                            <div class="overflow-hidden">
                                                                                <span class="text-500 text-sm block">Endereço de Envio</span>
                                                                                <span class="text-800 font-medium text-sm block white-space-nowrap overflow-hidden text-overflow-ellipsis">
                                                                                       #{fichaAtendimentoSacBean.cliente.enderecoResumido ne null ? fichaAtendimentoSacBean.cliente.enderecoResumido : 'Rua das Flores, 123 - Jd. Paulista'}
                                                                                 </span>
                                                                                <small class="text-primary cursor-pointer hover:underline">Confirmar endereço</small>
                                                                            </div>
                                                                        </div>

                                                                        <div class="flex align-items-center justify-content-between mt-4 pt-3 border-top-1 border-300">
                                                                            <span class="text-600 font-medium">Custo da emissão:</span>
                                                                            <span class="text-green-600 font-bold">Isento</span>
                                                                        </div>


                                                                    </h:panelGroup>
                                                                </div>
                                                            </div>

                                                        </h:panelGroup>

                                                        <h:panelGroup
                                                                rendered="#{fichaAtendimentoSacBean.abaAtiva eq 'NOTAS'}"
                                                                styleClass="fadein animation-duration-300">
                                                            <div class="flex align-items-center mb-4">
                                                                <i class="pi pi-pencil text-primary text-xl mr-2"></i>
                                                                <h2 class="text-xl text-900 font-bold m-0">Anotações Internas</h2>
                                                            </div>
                                                            <p:inputTextarea rows="10" styleClass="w-full" spellcheck="true" lang="pt-BR"
                                                                             value="#{fichaAtendimentoSacBean.atendimento.anotacao}"
                                                                             placeholder="Digite notas sobre este cartão..."/>
                                                        </h:panelGroup>


                                                    </div>

                                                    <div class="bg-blue-50 border-top-1 border-blue-100 p-4">

                                                        <div class="flex align-items-center justify-content-between mb-3">
                                                            <h3 class="text-blue-800 text-lg font-bold m-0 flex align-items-center">
                                                                <i class="pi pi-verified mr-2"></i> Ações do Atendimento
                                                            </h3>
                                                        </div>

                                                        <div class="surface-0 border-1 border-blue-100 border-round p-3 mb-4 flex flex-column md:flex-row align-items-start md:align-items-center justify-content-between gap-2 shadow-1">

                                                            <div class="flex flex-column">
                                                                <span class="text-500 text-xs font-bold uppercase mb-1">Classificação Definida</span>
                                                                <span class="text-800 font-medium text-lg">
                <i class="pi pi-tag text-blue-600 mr-1 text-sm"></i>
                                                                    #{fichaAtendimentoSacBean.motivoSelecionado.descricao}
                                                                    <span class="text-400 mx-2">|</span>
                                                                    #{fichaAtendimentoSacBean.subMotivoSelecionado.descricao}
            </span>
                                                            </div>

                                                            <p:commandButton value="Alterar"
                                                                             icon="pi pi-pencil"
                                                                             title="Redefinir classificação"
                                                                             actionListener="#{fichaAtendimentoSacBean.limparClassificacao()}"
                                                                             update="@form" process="@this"
                                                                             styleClass="ui-button-flat ui-button-secondary text-sm font-bold"/>
                                                        </div>

                                                        <div class="grid formgrid">

                                                            <div class="col-12 md:col-6">
                                                                <p:commandButton value="Direcionar ao N2"
                                                                                 icon="pi pi-arrow-right"
                                                                                 iconPos="right"
                                                                                 update="dlgDerivarN2"
                                                                                 global="false"
                                                                                 action="#{fichaAtendimentoSacBean.onBuscarDepartamentos()}"
                                                                                 process="@this"
                                                                                 oncomplete="PF('dlgDerivarN2').show()"
                                                                                 styleClass="ui-button-outlined ui-button-warning w-full border-round-lg font-bold py-3 bg-white surface-hover"/>
                                                            </div>

                                                            <div class="col-12 md:col-6">
                                                                <p:commandButton value="Finalizar Atendimento"
                                                                                 icon="pi pi-check"
                                                                                 process="@this panelOperacional"
                                                                                 update="dlgFinalizar"
                                                                                 oncomplete="PF('dlgFinalizar').show();"
                                                                                 styleClass="ui-button-success w-full border-round-lg font-bold py-3 shadow-2"/>
                                                            </div>

                                                        </div>
                                                    </div>

                                                </div>
                                            </h:panelGroup>


                                        </div>

                                    </div>

                                </div>

                            </div>

                        </h:panelGroup>


                        <!--  SEM ATENDIMENTO ESPERANDO...-->
                        <h:panelGroup rendered="#{fichaAtendimentoSacBean.atendimento eq null}">

                            <p:remoteCommand name="receberDadosChamada" actionListener="#{fichaAtendimentoSacBean.onCliente}"
                                             update="@form" oncomplete="tocarNotificacao();"/>

                            <div class="grid justify-content-center mt-4">
                                <div class="col-12 md:col-8 lg:col-6">

                                    <div class="flex justify-content-end mb-3 gap-2">
                                 <!--       <p:commandButton icon="pi pi-phone" value="Simular Chamada"
                                                         process="@this" update="dlgPonto"
                                                         onclick="enviarMocado()"
                                                         styleClass="ui-button-outlined ui-button-secondary text-sm"/>-->

                                        <p:commandButton icon="pi pi-cog" value="Config. Ramal"
                                                         oncomplete="PF('dlgPonto').show()" process="@this"
                                                         update="dlgPonto"
                                                         actionListener="#{fichaAtendimentoSacBean.onListarPontosAtendimentos()}"
                                                         styleClass="ui-button-outlined ui-button-secondary text-sm"/>
                                    </div>

                                    <div class="surface-card shadow-2 border-round-xl p-3 mb-3 flex align-items-center justify-content-between border-left-3 border-blue-500">
                                        <div class="flex align-items-center">
                                            <p:avatar icon="pi pi-user" styleClass="mr-3 bg-blue-100 text-blue-600"
                                                      size="large" shape="circle"/>
                                            <div>
                                                <div id="statusMsg" class="text-sm text-500 mt-1">Conectando...</div>

                                                <div class="flex align-items-center mt-1">
                                                    <i class="pi pi-phone text-500 mr-1 text-sm" />
                                                    <span class="text-600 text-sm">Ramal:
                    <span class="font-bold text-700">
                        #{empty fichaAtendimentoSacBean.usuario.pontoAtendimento ? 'Sem Ramal' : fichaAtendimentoSacBean.usuario.pontoAtendimento.ramal}
                    </span>
                </span>
                                                </div>
                                            </div>
                                        </div>

                                        <p:tag id="statusTag" severity="info" value="AGUARDE..." icon="pi pi-spin pi-spinner"
                                               styleClass="white-space-nowrap" rounded="true"/>
                                    </div>

                                    <p:card id="cpfBox"
                                            styleClass="shadow-4 border-round-2xl border-none overflow-hidden">

                                        <h:panelGroup rendered="#{empty fichaAtendimentoSacBean.cpf}" layout="block"
                                                      styleClass="text-center py-6 flex flex-column align-items-center justify-content-center">

                                            <div class="waiting-icon mb-4">
                                                <i class="pi pi-phone text-5xl"></i>
                                            </div>

                                            <span class="text-800 font-bold text-xl block mb-2">Aguardando nova chamada...</span>
                                            <span class="text-500 text-sm">O sistema identificará o cliente automaticamente.</span>
                                        </h:panelGroup>

                                        <h:panelGroup rendered="#{not empty fichaAtendimentoSacBean.cpf}" layout="block"
                                                      styleClass="fadein animation-duration-500 surface-50 h-full">

                                            <div class="bg-blue-600 text-white p-3 flex align-items-center justify-content-between">
                                                <span class="font-bold flex align-items-center"><i
                                                        class="pi pi-phone-at-call mr-2 animate-pulse"></i> CHAMADA ENTRANDO</span>
                                                <span class="text-sm opacity-90">Identificando...</span>
                                            </div>

                                            <div class="p-4 grid align-items-center">
                                                <div class="col-12 md:col-6 text-center md:text-left border-bottom-1 md:border-bottom-none md:border-right-1 border-300 pb-3 md:pb-0">
                                                    <span class="block text-500 font-semibold text-xs uppercase mb-1">Cliente Identificado</span>
                                                    <div class="text-3xl font-bold text-blue-800 font-monospace tracking-wide">
                                                        #{fichaAtendimentoSacBean.cpf}
                                                    </div>
                                                </div>

                                                <div class="col-12 md:col-6 text-center">
                                                    <div class="flex flex-column align-items-center justify-content-center">
                                                        <i class="pi pi-spin pi-spinner text-blue-600 text-3xl mb-2"></i>
                                                        <span class="text-700 font-medium">Carregando ficha...</span>
                                                        <p:progressBar mode="indeterminate"
                                                                       styleClass="h-1rem w-10rem mt-2"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </h:panelGroup>

                                    </p:card>
                                </div>
                            </div>
                        </h:panelGroup>


                        <script>
                            function enviarMocado() {
                                receberDadosChamada([
                                    {name: 'cpf', value: "06726506651"},
                                    {name: 'audioId', value: ""},
                                    {name: 'numero', value: "31999631311"},
                                    {name: 'opcao', value: "6"}
                                ]);
                            }

                        </script>

                        <p:dialog header="Finalizar Atendimento"
                                  widgetVar="dlgFinalizar"
                                  id="dlgFinalizar"
                                  modal="true"
                                  responsive="true"
                                  width="500"
                                  showEffect="fade"
                                  hideEffect="fade"
                                  draggable="false"
                                  resizable="false"
                                  fitViewport="true"
                                  blockScroll="true"
                                  styleClass="border-round-xl">

                            <f:facet name="header">
                                <div class="flex align-items-center">
                                    <div class="bg-green-100 border-circle w-2rem h-2rem flex align-items-center justify-content-center mr-2">
                                        <i class="pi pi-check text-green-600 text-lg"></i>
                                    </div>
                                    <span class="text-xl font-bold">Finalizar Atendimento</span>
                                </div>
                            </f:facet>

                            <h:panelGroup id="pbpDlgFinalizar" rendered="#{not empty fichaAtendimentoSacBean.atendimento}">

                                <div class="pt-2 pr-2" style="max-height: 60vh; overflow-y: auto; overflow-x: hidden;">

                                    <div class="mb-3">
                                        <span class="text-500 block text-sm mb-1">Classificação Atual:</span>
                                        <div class="surface-100 p-2 border-round text-700 font-medium text-sm flex align-items-center">
                                            <i class="pi pi-tag mr-2 text-primary"></i>
                                            <h:outputText value="#{fichaAtendimentoSacBean.motivoSelecionado.descricao} | #{fichaAtendimentoSacBean.subMotivoSelecionado.descricao}"/>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <span class="text-500 block text-sm mb-1">Protocolo da demanda:</span>
                                        <div class="surface-100 p-2 border-round flex align-items-center justify-content-between bg-blue-50 border-1 border-blue-100">
                                            <div class="flex align-items-center">
                                                <i class="pi pi-hashtag mr-2 text-blue-600"></i>
                                                <h:outputText value="#{fichaAtendimentoSacBean.atendimento.protocolo}"
                                                              styleClass="text-900 font-bold text-lg select-all"/>
                                            </div>
                                            <i class="pi pi-id-card text-blue-300"></i>
                                        </div>
                                    </div>

                                    <div class="field">
                                        <div class="flex align-items-center mb-2">
                                            <p:outputLabel for="obsFinal" value="Considerações Finais:" styleClass="font-bold text-900 mr-2"/>
                                            <span class="text-red-500 font-bold mr-2">*</span>
                                        </div>

                                        <p:inputTextarea id="obsFinal"
                                                         value="#{fichaAtendimentoSacBean.atendimento.observacao}"
                                                         rows="4" styleClass="w-full bg-gray-50 border-round-lg"
                                                         placeholder="Descreva a solução aplicada ou orientações passadas..."
                                                         required="true" spellcheck="true" lang="pt-BR"
                                                         requiredMessage="A observação é obrigatória para finalizar."/>

                                        <small class="text-600 block mt-1"><i class="pi pi-info-circle mr-1"></i>Obrigatório para registro histórico.</small>
                                        <p:message for="obsFinal" id="msgObs"/>
                                    </div>

                                </div> </h:panelGroup>

                            <f:facet name="footer">
                                <div class="flex justify-content-end gap-2 pt-3 border-top-1 border-100 bg-white border-round-bottom-xl">
                                    <p:commandButton value="Cancelar" icon="pi pi-times"
                                                     onclick="PF('dlgFinalizar').hide()" type="button"
                                                     styleClass="ui-button-outlined ui-button-secondary font-bold"/>

                                    <p:commandButton value="Confirmar" icon="pi pi-check"
                                                     actionListener="#{fichaAtendimentoSacBean.salvarSolicitacaoAtendimento()}"
                                                     update="msgObs pbpDlgFinalizar @form"
                                                     process="@this obsFinal"
                                                     styleClass="ui-button-success font-bold px-4"/>
                                </div>
                            </f:facet>

                        </p:dialog>


                        <p:dialog header="Direcionar para Área N2"
                                  widgetVar="dlgDerivarN2"
                                  id="dlgDerivarN2"
                                  modal="true"
                                  responsive="true"
                                  width="500"
                                  showEffect="fade"
                                  hideEffect="fade"
                                  draggable="false"
                                  resizable="false"
                                  fitViewport="true"
                                  blockScroll="true"
                                  styleClass="border-round-xl">

                            <f:facet name="header">
                                <div class="flex align-items-center">
                                    <div class="bg-orange-100 border-circle w-2rem h-2rem flex align-items-center justify-content-center mr-2">
                                        <i class="pi pi-directions text-orange-600 text-lg font-bold"></i>
                                    </div>
                                    <span class="text-xl font-bold text-900">Escalar para Nível 2</span>
                                </div>
                            </f:facet>

                            <h:panelGroup rendered="#{not empty fichaAtendimentoSacBean.atendimento}" id="pnpDerivarN2">

                                <div class="pt-2 pr-2" style="max-height: 60vh; overflow-y: auto; overflow-x: hidden;">

                                    <div class="mb-3">
                                        <span class="text-500 block text-sm mb-1">Classificação Atual:</span>
                                        <div class="surface-100 p-2 border-round text-700 font-medium text-sm flex align-items-center">
                                            <i class="pi pi-tag mr-2 text-orange-500"></i>
                                            <h:outputText value="#{fichaAtendimentoSacBean.motivoSelecionado.descricao} | #{fichaAtendimentoSacBean.subMotivoSelecionado.descricao}"/>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <span class="text-500 block text-sm mb-1">Protocolo da demanda:</span>
                                        <div class="surface-100 p-2 border-round flex align-items-center justify-content-between bg-blue-50 border-1 border-blue-100">
                                            <div class="flex align-items-center">
                                                <i class="pi pi-hashtag mr-2 text-blue-600"></i>
                                                <h:outputText value="#{fichaAtendimentoSacBean.atendimento.protocolo}"
                                                              styleClass="text-900 font-bold text-lg select-all"/>
                                            </div>
                                            <i class="pi pi-id-card text-blue-300"></i>
                                        </div>
                                    </div>

                                    <p:divider styleClass="mb-4" />

                                    <div class="field mb-4">
                                        <p:outputLabel value="Setor de Destino" for="selectDpo" styleClass="font-bold text-900 mb-2 block"/>
                                        <div class="ui-inputgroup">
                                            <span class="ui-inputgroup-addon"><i class="pi pi-sitemap text-orange-500"></i></span>
                                            <p:selectOneMenu id="selectDpo" value="#{fichaAtendimentoSacBean.atendimento.departamentoDerivado}"
                                                             converter="omnifaces.SelectItemsConverter"
                                                             required="true" requiredMessage="Selecione o setor de destino."
                                                             styleClass="w-full" autoWidth="false" filter="true" filterMatchMode="contains">

                                                <f:selectItem itemLabel="Selecione o setor..." noSelectionOption="true" itemValue="#{null}"/>
                                                <f:selectItems value="#{fichaAtendimentoSacBean.listDepartamentos}" var="dpo"
                                                               itemLabel="#{dpo.descricao}" itemValue="#{dpo}"/>
                                            </p:selectOneMenu>
                                        </div>
                                        <p:message for="selectDpo"/>
                                    </div>

                                    <div class="field">
                                        <div class="flex align-items-center mb-2">
                                            <p:outputLabel for="obsDerivacao" value="Justificativa da Escalação:" styleClass="font-bold text-900 mr-2"/>
                                            <span class="text-red-500 font-bold">*</span>
                                        </div>

                                        <p:inputTextarea id="obsDerivacao"
                                                         value="#{fichaAtendimentoSacBean.atendimento.observacao}"
                                                         rows="4" styleClass="w-full bg-gray-50 border-round-lg" spellcheck="true" lang="pt-BR"
                                                         placeholder="Descreva tecnicamente o motivo do envio para N2..."
                                                         required="true" requiredMessage="A justificativa é obrigatória."/>

                                        <small class="text-600 block mt-1"><i class="pi pi-info-circle mr-1"></i>Obrigatório para análise do backoffice.</small>
                                        <p:message for="obsDerivacao"/>
                                    </div>

                                </div> </h:panelGroup>

                            <f:facet name="footer">
                                <div class="flex justify-content-between gap-2 pt-3 border-top-1 border-100 bg-white border-round-bottom-xl">

                                    <p:commandButton value="Cancelar" icon="pi pi-times"
                                                     onclick="PF('dlgDerivarN2').hide()" type="button"
                                                     styleClass="ui-button-outlined ui-button-secondary w-6 border-round-lg font-bold"/>

                                    <p:commandButton value="Confirmar Envio" icon="pi pi-send"
                                                     iconPos="right"
                                                     actionListener="#{fichaAtendimentoSacBean.derivarAtendimentoN2()}"
                                                     update="pnpDerivarN2 @form"
                                                     process="@this pnpDerivarN2"
                                                     styleClass="ui-button-warning w-6 border-round-lg font-bold shadow-1"/>
                                </div>
                            </f:facet>

                        </p:dialog>

                        <p:dialog header="Editar dados cadastrais" widgetVar="dlgEditarDadosCadastrais"
                                  id="dlgEditarDadosCadastrais"
                                  modal="true" responsive="true" width="750" showEffect="fade" hideEffect="fade"
                                  draggable="false" resizable="false" styleClass="border-round-xl">

                            <f:facet name="header">
                                <div class="flex align-items-center">
                                    <div class="bg-blue-100 border-circle w-2rem h-2rem flex align-items-center justify-content-center mr-2">
                                        <i class="pi pi-user-edit text-blue-600 text-lg font-bold"></i>
                                    </div>
                                    <span class="text-xl font-bold text-900">Editar Cadastro</span>
                                </div>
                            </f:facet>

                            <h:panelGroup rendered="#{not empty fichaAtendimentoSacBean.atendimento}"
                                          id="pnpEditarDados">

                                <div class="ui-fluid formgrid grid">

                                    <div class="col-12 mb-3">
                                        <span class="text-500 font-bold text-sm uppercase border-bottom-1 border-200 block pb-2">
                                            <i class="pi pi-id-card mr-1"></i>Dados Pessoais
                                        </span>
                                                    </div>

                                    <div class="field col-12 md:col-8">
                                        <p:outputLabel for="txtNomeEdit" value="Nome Completo" styleClass="font-semibold"/>
                                        <div class="ui-inputgroup">
                                            <span class="ui-inputgroup-addon bg-gray-50"><i class="pi pi-user"></i></span>
                                            <p:inputText id="txtNomeEdit"
                                                         value="#{fichaAtendimentoSacBean.cliente.nome}"
                                                         required="true" requiredMessage="Nome é obrigatório"/>
                                        </div>
                                        <p:message for="txtNomeEdit" display="text"/>
                                    </div>

                                    <div class="field col-12 md:col-4">
                                        <p:outputLabel for="txtCpfEdit" value="CPF" styleClass="font-semibold"/>
                                        <p:inputMask id="txtCpfEdit" value="#{fichaAtendimentoSacBean.cliente.cpf}"
                                                     mask="999.999.999-99"
                                                     required="true" requiredMessage="CPF é obrigatório"
                                                     styleClass="bg-gray-50"/> <p:message for="txtCpfEdit" display="text"/>
                                    </div>

                                    <div class="field col-12 md:col-4">
                                        <p:outputLabel for="txtDataNascimentoEdit" value="Data de Nascimento" styleClass="font-semibold"/>
                                        <p:datePicker id="txtDataNascimentoEdit"
                                                      value="#{fichaAtendimentoSacBean.cliente.dataNascimento}"
                                                      pattern="dd/MM/yyyy"
                                                      mask="true"
                                                      monthNavigator="true"
                                                      yearNavigator="true"
                                                      showIcon="true"/>
                                    </div>

                                    <div class="field col-12 md:col-4">
                                        <p:outputLabel for="txtNomeMaeEdit" value="Nome da Mãe" styleClass="font-semibold"/>
                                        <p:inputText id="txtNomeMaeEdit" value="#{fichaAtendimentoSacBean.cliente.nomeMae}"/>
                                    </div>

                                    <div class="field col-12 md:col-4">
                                        <p:outputLabel for="txtNomePaiEdit" value="Nome do Pai" styleClass="font-semibold"/>
                                        <p:inputText id="txtNomePaiEdit" value="#{fichaAtendimentoSacBean.cliente.nomePai}"/>
                                    </div>

                                    <div class="col-12 mt-4 mb-3">
                <span class="text-500 font-bold text-sm uppercase border-bottom-1 border-200 block pb-2">
                    <i class="pi pi-map-marker mr-1"></i>Endereço
                </span>
                                    </div>

                                    <div class="field col-12 md:col-3">
                                        <p:outputLabel for="txtCepEdit" value="CEP" styleClass="font-semibold"/>
                                        <div class="ui-inputgroup">
                                            <p:inputMask id="txtCepEdit" value="#{fichaAtendimentoSacBean.endereco.cep}"
                                                         mask="99.999-999" required="true" requiredMessage="CEP obrigatório"/>
                                            <p:commandButton icon="pi pi-search"
                                                             title="Buscar CEP"
                                                             styleClass="ui-button-secondary ui-button-outlined"
                                                             actionListener="#{fichaAtendimentoSacBean.onBuscarEndereco()}"
                                                             process="@this txtCepEdit"
                                                             update="txtLogradouro txtBairroEdit txtCidadeEdit txtUfEdit grl"/>
                                        </div>
                                        <p:message for="txtCepEdit" display="text"/>
                                    </div>

                                    <div class="field col-12 md:col-7">
                                        <p:outputLabel for="txtLogradouro" value="Logradouro" styleClass="font-semibold"/>
                                        <p:inputText id="txtLogradouro"
                                                     value="#{fichaAtendimentoSacBean.endereco.logradouro}"
                                                     required="true" requiredMessage="Endereço obrigatório"/>
                                        <p:message for="txtLogradouro" display="text"/>
                                    </div>

                                    <div class="field col-12 md:col-2">
                                        <p:outputLabel for="txtNumeroEdit" value="Número" styleClass="font-semibold"/>
                                        <p:inputText id="txtNumeroEdit"
                                                     value="#{fichaAtendimentoSacBean.endereco.numero}"
                                                     required="true" requiredMessage="Número obrigatório"/>
                                        <p:message for="txtNumeroEdit" display="text"/>
                                    </div>

                                    <div class="field col-12 md:col-4">
                                        <p:outputLabel for="txtBairroEdit" value="Bairro" styleClass="font-semibold"/>
                                        <p:inputText id="txtBairroEdit"
                                                     value="#{fichaAtendimentoSacBean.endereco.bairro}"
                                                     required="true" requiredMessage="Bairro obrigatório"/>
                                        <p:message for="txtBairroEdit" display="text"/>
                                    </div>

                                    <div class="field col-12 md:col-4">
                                        <p:outputLabel for="txtComplementoEdit" value="Complemento" styleClass="font-semibold"/>
                                        <p:inputText id="txtComplementoEdit"
                                                     value="#{fichaAtendimentoSacBean.endereco.complemento}"/>
                                    </div>

                                    <div class="field col-12 md:col-3">
                                        <p:outputLabel for="txtCidadeEdit" value="Cidade" styleClass="font-semibold"/>
                                        <p:inputText id="txtCidadeEdit"
                                                     value="#{fichaAtendimentoSacBean.endereco.cidade}"
                                                     required="true" requiredMessage="Cidade obrigatória"/>
                                    </div>

                                    <div class="field col-12 md:col-1">
                                        <p:outputLabel for="txtUfEdit" value="UF" styleClass="font-semibold"/>
                                        <p:selectOneMenu id="txtUfEdit" value="#{fichaAtendimentoSacBean.endereco.uf}"
                                                         required="true" autoWidth="false">
                                            <f:selectItem itemLabel="-" itemValue="" noSelectionOption="true"/>
                                            <f:selectItem itemLabel="SP" itemValue="SP"/>
                                            <f:selectItem itemLabel="RJ" itemValue="RJ"/>
                                            <f:selectItem itemLabel="MG" itemValue="MG"/>
                                        </p:selectOneMenu>
                                    </div>

                                </div>

                            </h:panelGroup>

                            <f:facet name="footer">
                                <div class="flex justify-content-end gap-2 pt-3 border-top-1 border-200">
                                    <p:commandButton value="Cancelar" icon="pi pi-times"
                                                     onclick="PF('dlgEditarDadosCadastrais').hide()" type="button"
                                                     styleClass="ui-button-outlined ui-button-secondary font-bold"/>

                                    <p:commandButton value="Salvar Alterações" icon="pi pi-check"
                                                     actionListener="#{fichaAtendimentoSacBean.salvarDadosCadastrais()}"
                                                     update="pnpEditarDados pnpDadosCliente grl"
                                                     process="pnpEditarDados @this"
                                                     oncomplete="if (!args.validationFailed) PF('dlgEditarDadosCadastrais').hide()"
                                                     styleClass="ui-button-primary font-bold shadow-2"/>
                                </div>
                            </f:facet>

                        </p:dialog>

                        <p:dialog header="Registrar Pausa" widgetVar="dlgPausa" id="dlgPausa"
                                  modal="true" responsive="true" width="450" showEffect="fade" hideEffect="fade"
                                  draggable="false" resizable="false" styleClass="border-round-xl">

                            <f:facet name="header">
                                <div class="flex align-items-center">
                                    <div class="bg-orange-100 border-circle w-2rem h-2rem flex align-items-center justify-content-center mr-2">
                                        <i class="pi pi-clock text-orange-600 text-lg font-bold"></i></div>
                                    <span class="text-xl font-bold text-900">Registrar Pausa</span>
                                </div>
                            </f:facet>

                            <h:panelGroup rendered="#{not empty fichaAtendimentoSacBean.atendimento}" id="pnpPausa">

                                <div class="pt-2">

                                    <div class="surface-ground p-3 border-round-lg mb-4 border-1 border-200">

                                        <span class="text-600 block text-xs uppercase font-bold mb-1">Em atendimento</span>

                                        <div class="text-800 font-medium text-sm flex align-items-center">

                                            <i class="pi pi-tag mr-2 text-orange-500"/>

                                            <h:outputText
                                                    value="#{fichaAtendimentoSacBean.motivoSelecionado.descricao} | #{fichaAtendimentoSacBean.subMotivoSelecionado.descricao}"
                                                    rendered="#{not empty fichaAtendimentoSacBean.motivoSelecionado and not empty fichaAtendimentoSacBean.subMotivoSelecionado }"/>

                                            <h:outputText value="Sem classificação definida"
                                                          rendered="#{empty fichaAtendimentoSacBean.motivoSelecionado and empty fichaAtendimentoSacBean.subMotivoSelecionado}"
                                                          styleClass="font-italic text-600"/>
                                        </div>
                                    </div>

                                    <div class="field">
                                        <p:outputLabel for="comboPausa" value="Motivo da Pausa:"
                                                       styleClass="font-bold text-900 mb-2 block">
                                            <span class="text-red-500">*</span>
                                        </p:outputLabel>

                                        <p:selectOneMenu id="comboPausa"
                                                         value="#{fichaAtendimentoSacBean.pausa}"
                                                         converter="omnifaces.SelectItemsConverter"
                                                         styleClass="w-full border-round-lg shadow-1"
                                                         autoWidth="false"
                                                         required="true"
                                                         requiredMessage="Selecione o motivo da pausa.">

                                            <f:selectItem itemLabel="Selecione uma opção..." itemValue="#{null}"
                                                          noSelectionOption="true"/>
                                            <f:selectItems value="#{fichaAtendimentoSacBean.listPausas}" var="p"
                                                           itemLabel="#{p.descricao}" itemValue="#{p}"/>
                                        </p:selectOneMenu>
                                        <small class="text-600">O tempo de pausa começará a contar imediatamente.</small>
                                        <p:message for="comboPausa" id="msgPausa"/>
                                    </div>

                                </div>
                            </h:panelGroup>

                            <f:facet name="footer">

                                <div class="flex justify-content-between gap-2 pt-3 border-top-1 border-200">

                                    <p:commandButton value="Cancelar" icon="pi pi-times"
                                                     onclick="PF('dlgPausa').hide();" type="button"
                                                     styleClass="ui-button-outlined ui-button-secondary w-6 border-round-lg font-bold"/>

                                    <p:commandButton value="Iniciar Pausa" icon="pi pi-pause"
                                                     actionListener="#{fichaAtendimentoSacBean.iniciarPausaAtendimento()}"
                                                     update="grl msgPausa"
                                                     process="@this comboPausa"
                                                     oncomplete="if (!args.validationFailed) PF('dlgPausa').hide()"
                                                     styleClass="ui-button-primary w-6 border-round-lg font-bold bg-primary-500 border-primary-500 hover:bg-primary-600"/>
                                </div>

                            </f:facet>

                        </p:dialog>

                    </h:form>

                </div>

            </div>

            <ui:include src="/pages/atendimento/modalPainelPontoAtendimento.xhtml"/>

        </div>

        <h:form id="formPst" prependId="false">

            <p:growl id="grl" widgetVar="grl" globalOnly="true" showSummary="false" life="8000" showDetail="true">
                <p:autoUpdate/>
            </p:growl>

            <h:outputScript   name="js/pstfone.js?v5" />
            <script type="text/javascript">
                //<![CDATA[
                console.log("Iniciando scripts pst");
                var servidor = "#{fichaAtendimentoSacBean.usuario.pontoAtendimento.pabx.url}";
                var login = "#{fichaAtendimentoSacBean.usuario.pontoAtendimento.ramal}";
                iniciarPst(servidor, login);
                //]]>
            </script>
        </h:form>

        <script type="text/javascript">
            (function () {
                var startMillis = Number("#{fichaAtendimentoSacBean.inicioAtendimentoMillis}");

                function atualizarCronometro() {
                    console.log('INICIANDO CRONOMETRO: ' + startMillis)
                    if (!startMillis || startMillis === 0) return;

                    var now = new Date().getTime();


                    var diff = Math.max(0, now - startMillis);


                    var hours = Math.floor(diff / (1000 * 60 * 60));
                    var minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    var seconds = Math.floor((diff % (1000 * 60)) / 1000);


                    var h = String(hours).padStart(2, '0');
                    var m = String(minutes).padStart(2, '0');
                    var s = String(seconds).padStart(2, '0');

                    var display = document.getElementById("cronometroTma");
                    if (display) {
                        display.innerText = h + ":" + m + ":" + s;

                        // Exemplo: Se passar de 10 min, fica vermelho
                        // Usamos '>' (maior que), que o JSF geralmente aceita,
                        // mas se der erro, use (diff >= 600000)
                        if (diff > 600000) {
                            display.style.color = "red";
                        }
                    }
                }

                setInterval(atualizarCronometro, 1000);
                atualizarCronometro();
            })();
        </script>
        <style>
            @keyframes pulse-blue {
                0% {
                    transform: scale(1);
                    box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
                }
                70% {
                    transform: scale(1.1);
                    box-shadow: 0 0 0 20px rgba(59, 130, 246, 0);
                }
                100% {
                    transform: scale(1);
                    box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
                }
            }

            .waiting-icon {
                animation: pulse-blue 2s infinite;
                border-radius: 50%;
                padding: 1.5rem;
                background-color: #eff6ff; /* blue-50 */
                color: #3b82f6; /* blue-500 */
            }

            .font-monospace {
                font-family: 'Courier New', monospace;
                letter-spacing: 1px;
            }

            .animate-pulse {
                animation: pulse-red 2s infinite;
            }

            @keyframes pulse-red {
                0% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.5;
                }
                100% {
                    opacity: 1;
                }
            }

            .pulse-container {
                animation: ripple 1.5s infinite;
                border-radius: 50%;
            }

            @keyframes ripple {
                0% {
                    box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.1);
                }
                100% {
                    box-shadow: 0 0 0 20px rgba(0, 0, 0, 0);
                }
            }
        </style>
    </ui:define>
</ui:composition>