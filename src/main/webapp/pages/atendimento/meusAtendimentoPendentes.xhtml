<ui:fragment xmlns="http://www.w3.org/1999/xhtml"
             xmlns:h="http://java.sun.com/jsf/html"
             xmlns:f="http://java.sun.com/jsf/core"
             xmlns:pe="http://primefaces.org/ui/extensions"
             xmlns:ui="http://java.sun.com/jsf/facelets"
             xmlns:p="http://primefaces.org/ui">

    <h:form id="formPendente" prependId="false">

        <div class="grid ui-fluid">

            <div class="col-12">
                <div class="surface-card shadow-2 border-round p-4 h-full border-left-3 border-orange-500">

                    <div class="flex justify-content-between align-items-center mb-3 border-bottom-1 border-100 pb-2">
                        <div class="flex align-items-center">
                            <div class="bg-orange-100 text-orange-600 border-circle w-2rem h-2rem flex align-items-center justify-content-center mr-2">
                                <i class="pi pi-clock text-lg"></i>
                            </div>
                            <span class="text-900 font-bold text-lg">Atendimento  Pendentes</span>
                        </div>
                        <span class="text-sm text-500">
                            Total: <span class="font-bold text-orange-600">#{meusAtendimentosBean.listAtendimentosPendentes.size()}</span>
                        </span>
                    </div>

                    <p:dataTable id="tablePendentes" var="pendentes"
                                 value="#{meusAtendimentosBean.listAtendimentosPendentes}"
                                 rows="10" paginator="true" paginatorPosition="bottom"
                                 emptyMessage="#{msg.emptyMessage}"
                                 stripedRows="true" showGridlines="true" reflow="true" size="small"
                                 rowKey="#{pendentes[0]}"
                                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                                 currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords}">

                        <p:column headerText="Data" width="120" styleClass="text-center">
                            <span class="p-column-title">Data:</span>
                            <h:outputText value="#{pendentes[4]}">
                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                            </h:outputText>
                        </p:column>

                        <p:column headerText="Campanha">
                            <span class="p-column-title">Campanha:</span>
                            <h:outputText value="#{pendentes[1]}" styleClass="font-medium"/>
                        </p:column>

                        <p:column headerText="Cliente">
                            <span class="p-column-title">Nome:</span>
                            <h:outputText value="#{pendentes[2]}" />
                        </p:column>

                        <p:column headerText="CPF" width="130">
                            <span class="p-column-title">CPF:</span>
                            <div class="flex align-items-center">
                                <i class="pi pi-id-card mr-2 text-gray-400"></i>
                                <h:outputText value="#{pendentes[3]}" />
                            </div>
                        </p:column>

                        <p:column width="100" styleClass="text-center">

                            <p:commandButton icon="pi pi-eye"
                                             title="Visualizar Detalhes"
                                             styleClass="rounded-button ui-button-outlined ui-button-secondary mr-1"
                                             onclick="PF('dlgVisualizarAtendimento').show();"
                                             update=":formVisualizar"
                                             action="#{meusAtendimentosBean.visualizarAtendimento(pendentes[0])}" />

                            <p:commandButton icon="pi pi-play"
                                             title="Iniciar Atendimento"
                                             styleClass="rounded-button ui-button-outlined ui-button-success"
                                             oncomplete="PF('dlgConfirmarAntecipacaoPendente').show();"
                                             global="false" update="@form">
                                <f:setPropertyActionListener value="#{pendentes[0]}" target="#{meusAtendimentosBean.idAtendimento}" />
                            </p:commandButton>

                        </p:column>

                    </p:dataTable>
                </div>
            </div>
        </div>

        <pe:tooltip global="true" myPosition="left center" atPosition="right center" styleClass="qtip-default" />

        <p:confirmDialog id="dlgConfirmarAntecipacaoPendente" widgetVar="dlgConfirmarAntecipacaoPendente"
                         responsive="true" appendTo="@(body)"
                         header="Retomar Atendimento"
                         message="Deseja iniciar este atendimento pendente agora?"
                         icon="pi pi-exclamation-triangle text-orange-500">

            <p:commandButton id="simConfirmaPendente" value="Sim, Iniciar" icon="pi pi-check"
                             action="#{meusAtendimentosBean.adiantarFichaAtendimentoNaoTrabalado()}"
                             oncomplete="PF('dlgConfirmarAntecipacaoPendente').hide();"
                             immediate="true"
                             styleClass="ui-confirmdialog-yes ui-button-success font-bold"/>

            <p:commandButton id="naoConfirmaPendente" value="NÃ£o" icon="pi pi-times"
                             type="button"
                             onclick="PF('dlgConfirmarAntecipacaoPendente').hide();"
                             styleClass="ui-confirmdialog-no ui-button-secondary ui-button-flat" />

        </p:confirmDialog>

    </h:form>

</ui:fragment>