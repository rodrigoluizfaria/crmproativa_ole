<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

    <h:panelGroup styleClass="card shadow-2 border-round-xl p-3 bg-white" layout="block">

        <h:panelGroup styleClass="flex justify-content-center mb-4 bg-gray-100 border-round-3xl p-1 " layout="block"
                      id="abasHistorico">

            <p:commandButton value="Atividades (#{fichaAtendimentoSacBean.listHistoricoAtividadesDto.size()})"
                             actionListener="#{fichaAtendimentoSacBean.onSetStepModalHistorico(0)}"
                             styleClass="#{fichaAtendimentoSacBean.stepHistorico eq 0 ? 'ui-button-text bg-white text-900 shadow-1': 'ui-button-flat ui-button-secondary text-600'}  flex-1 border-round-2xl"
                             process="@this" partialSubmit="true" update="abasHistorico pnpHistoricoPrincipal"
                             style="font-weight: 600;"/>

            <p:commandButton value="Protocolos (#{fichaAtendimentoSacBean.listHistoricoProtocolos.size()})"
                             process="@this" update="abasHistorico pnpHistoricoPrincipal" partialSubmit="true"
                             actionListener="#{fichaAtendimentoSacBean.onSetStepModalHistorico(1)}"
                             styleClass="#{fichaAtendimentoSacBean.stepHistorico eq 1 ? 'ui-button-text bg-white text-900 shadow-1': 'ui-button-flat ui-button-secondary text-600'}   flex-1 border-round-2xl"
                             style="font-weight: 700; color: #343a40 !important;"/>
        </h:panelGroup>


        <h:panelGroup id="pnpHistoricoPrincipal">

            <h:panelGroup styleClass="overflow-y-auto" id="pnpHistorico"
                          rendered="#{fichaAtendimentoSacBean.stepHistorico eq 1}">

                <div class="mb-3">
                    <h4 class="text-900 m-0 mb-1">Histórico de Protocolos</h4>
                    <span class="text-500 text-sm">Todos os protocolos do cliente</span>
                </div>

                <h:panelGroup styleClass="overflow-y-auto" style="max-height: 500px;" layout="block"
                              rendered="#{not empty fichaAtendimentoSacBean.listHistoricoProtocolos}">

                    <ui:repeat value="#{fichaAtendimentoSacBean.listHistoricoProtocolos}" var="proto">

                        <div class="surface-card border-1 border-200 border-round-xl p-3 mb-3 hover:shadow-2 hover:border-blue-500 transition-all transition-duration-200 cursor-pointer">
                            <div class="flex justify-content-between align-items-center mb-2">
                                <span class="font-bold text-700 text-lg">#{proto.numeroProtocolo}</span>

                                <div class="px-2 py-1 border-round border-1 border-green-500 bg-green-50 text-green-700 flex align-items-center text-sm font-bold">
                                    <i class="pi pi-check-circle mr-1 text-xs"></i>
                                    <span>#{proto.status}</span>
                                </div>
                            </div>

                            <div class="mb-2">
                        <span class="px-2 py-1 border-round bg-gray-200 text-700 text-sm font-bold">
                            #{proto.tipo}
                        </span>
                            </div>

                            <p class="text-600 text-sm line-height-3 m-0 mb-3">
                                #{proto.descricao}
                            </p>

                            <div class="flex justify-content-between align-items-center border-top-1 border-100 pt-2">
                                <div class="flex flex-column">
                                    <span class="text-500 text-xs">Abertura:</span>
                                    <span class="text-700 font-medium text-sm">
                                <h:outputText value="#{proto.dataAbertura}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                            </span>
                                </div>

                                <div class="flex flex-column align-items-end">
                                    <span class="text-500 text-xs">Prazo:</span>
                                    <span class="font-bold text-sm" style="color: #F59E0B;"> <h:outputText
                                            value="#{proto.dataPrazo}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                            </span>
                                </div>
                            </div>

                        </div>
                    </ui:repeat>
                </h:panelGroup>

                <!-- HISTORICO PROTOCOLOS VAZIO-->
                <h:panelGroup layout="block" rendered="#{ empty fichaAtendimentoSacBean.listHistoricoProtocolos}"
                              styleClass="col-12">

                    <div class="flex flex-column align-items-center justify-content-center p-5 bg-white border-round-xl border-1 border-200 shadow-1 h-full">

                        <div class="w-5rem h-5rem border-circle bg-bluegray-50 flex align-items-center justify-content-center mb-3">
                            <i class="pi pi-credit-card text-bluegray-400 text-4xl"></i>
                            <i class="pi pi-ban text-pink-500 text-xl absolute mb-4 ml-4 bg-white border-circle p-1"></i>
                        </div>

                        <span class="text-900 font-bold text-xl mb-2">Nenhum Atendimento encontrado</span>
                        <p class="text-600 m-0 text-center line-height-3"
                           style="max-width: 300px">
                            Não identificamos protocolos vinculados a este cliente no momento.
                        </p>

                        <div class="mt-4">
                            <p:commandButton value="Atualizar"
                                             icon="pi pi-refresh"
                                             styleClass="ui-button-outlined ui-button-secondary border-round-lg"/>
                        </div>
                    </div>

                </h:panelGroup>

            </h:panelGroup>

            <h:panelGroup styleClass="overflow-y-auto" id="pnpAtividade"
                          rendered="#{fichaAtendimentoSacBean.stepHistorico eq 0}">

                <div class="mb-3">
                    <h4 class="text-900 m-0 mb-1">Histórico de Atividades</h4>
                    <span class="text-500 text-sm">Linha do tempo do atendimento</span>
                </div>

                <h:panelGroup layout="block" rendered="#{not empty fichaAtendimentoSacBean.listHistoricoAtividadesDto}"
                              styleClass="col-12">

                    <div class="flex flex-column">

                        <ui:repeat value="#{fichaAtendimentoSacBean.listHistoricoAtividadesDto}" var="atv"
                                   varStatus="status">

                            <div class="flex">
                                <div class="flex flex-column align-items-center mr-3 relative" style="width: 40px;">

                                    <div class="absolute bg-gray-300"
                                         style="width: 2px; top: 0; bottom: 0; left: 50%; transform: translateX(-50%); z-index: 0; display: #{status.last ? 'none' : 'block'}"></div>

                                    <div class="flex align-items-center justify-content-center border-circle z-1 shadow-1
                                #{atv.autor eq 'Sistema' ? 'bg-blue-50 text-blue-500' : 'bg-blue-100 text-primary'}"
                                         style="width: 2.5rem; height: 2.5rem; background-color: #fff;">
                                        <i class="pi #{atv.tipoIcone} text-lg"></i>
                                    </div>
                                </div>

                                <div class="pb-4 w-full">
                                    <div class="surface-card border-1 border-200 border-round p-3 hover:shadow-2 transition-duration-200 relative">

                                        <div class="absolute w-1rem h-1rem surface-card border-left-1 border-bottom-1 border-200"
                                             style="left: -0.5rem; top: 0.75rem; transform: rotate(45deg);"></div>

                                        <span class="text-900 font-bold block mb-1">#{atv.tipoStatusAtividade.descricao}</span>

                                        <h:panelGroup rendered="#{not empty atv.detalhes}">
                                            <span class="text-700 font-medium text-sm block mb-1">#{atv.detalhes}</span>
                                        </h:panelGroup>

                                        <h:panelGroup rendered="#{not empty atv.descricao}">
                                            <span class="text-600 text-sm block mb-2">#{atv.descricao}</span>
                                        </h:panelGroup>

                                        <div class="flex align-items-center text-xs text-500 mt-2 pt-2 border-top-1 border-100">
                                            <i class="pi pi-clock mr-1"></i>
                                            <h:outputText value="#{atv.data}">
                                                <f:convertDateTime pattern="dd/MM, HH:mm"/>
                                            </h:outputText>
                                            <span class="mx-2">•</span>
                                            <span class="font-bold #{atv.autor eq 'Sistema' ? 'text-500' : 'text-blue-600'}">#{atv.autor}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </ui:repeat>
                    </div>


                </h:panelGroup>

                <!-- HISTORICO ATIVIDADE VAZIO-->
                <h:panelGroup layout="block" rendered="#{ empty fichaAtendimentoSacBean.listHistoricoAtividadesDto}"
                              styleClass="col-12">

                    <div class="flex flex-column align-items-center justify-content-center p-5 bg-white border-round-xl border-1 border-200 shadow-1 h-full">

                        <div class="w-5rem h-5rem border-circle bg-bluegray-50 flex align-items-center justify-content-center mb-3">
                            <i class="pi pi-history text-bluegray-400 text-4xl"></i>
                            <i class="pi pi-ban text-pink-500 text-xl absolute mb-4 ml-4 bg-white border-circle p-1"></i>
                        </div>


                        <p class="text-600 m-0 text-center line-height-3"
                           style="max-width: 300px">
                            Não há atividades.
                        </p>

                        <div class="mt-4">
                            <p:commandButton value="Atualizar"
                                             icon="pi pi-refresh"
                                             styleClass="ui-button-outlined ui-button-secondary border-round-lg"/>
                        </div>
                    </div>

                </h:panelGroup>

            </h:panelGroup>

        </h:panelGroup>
    </h:panelGroup>


</ui:composition>