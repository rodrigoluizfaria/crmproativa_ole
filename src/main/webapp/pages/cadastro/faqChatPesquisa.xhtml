<ui:fragment xmlns="http://www.w3.org/1999/xhtml"
             xmlns:h="http://java.sun.com/jsf/html"
             xmlns:f="http://java.sun.com/jsf/core"
             xmlns:ui="http://java.sun.com/jsf/facelets"
             xmlns:o="http://omnifaces.org/ui"
             xmlns:matriz="http://java.sun.com/jsf/composite/componentes"
             xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">

    <p:growl id="grl" widgetVar="grl" globalOnly="true" escape="false" showSummary="false" life="8000" showDetail="true"
             sticky="false">

        <p:autoUpdate/>

    </p:growl>


    <h:form id="formCadastro" prependId="false">

        <div class="card">

            <div class="ui-fluid formgrid grid">

                <matriz:selectEmpresa id="cmbEmpresa" managedBean="#{faqChatBean}" value="#{faqChatBean.empresa}"
                                      filter="true" style="col-12 md:col-3"/>

                <div class=" field col-12 md:col-3">

                    <p:outputLabel for="inputDesc" value="Descrição"/>

                    <p:inputText id="inputDesc" value="#{faqChatBean.grupoDescricao}" maxlength="50"/>

                </div>

                <div class=" field col-12 md:col-3">

                    <p:outputLabel for="selectOnePrincipalPesquisa" value="Grupo inicial"/>

                    <p:selectOneMenu id="selectOnePrincipalPesquisa" value="#{faqChatBean.idGrupo}"
                                     converter="omnifaces.SelectItemsConverter">

                        <f:selectItem itemLabel="Selecione" noSelectionOption="true"/>

                        <f:selectItems value="#{faqChatBean.listGruposPricipal}" var="grupo"
                                       itemLabel="#{grupo.descricao}" itemValue="#{grupo.id}"/>


                    </p:selectOneMenu>

                    <p:message for="selectOnePrincipalPesquisa"/>

                </div>

            </div>

            <div class="mt-4">

                <p:commandButton value="Pesquisar" styleClass="mr-3 ui-button-raised" id="btnSalvar"
                                 action="#{faqChatBean.pesquisar()}" update="@form grl" icon="pi pi-search"/>

                <p:commandButton value="Novo" id="btnNoo" styleClass="ui-button-outlined ui-button-raised" ajax="false"
                                 process="@this" immediate="true" action="#{faqChatBean.novo()}"
                                 icon="pi pi-plus-circle"/>

            </div>


        </div>


        <div class="mt-4">

            <div class="card">

                <p:dataTable id="tableGrupo" var="grupo" rows="10" paginator="true"
                             paginatorPosition="bottom" value="#{faqChatBean.listGrupo}"
                             emptyMessage="#{faqChatBean.listGrupo eq null? '' : msg.emptyMessage}"
                             currentPageReportTemplate="[#{msg.totalDeRegistros}: {totalRecords}]"
                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {Exporters}"
                             styleClass="ui-datatable-gridlines ui-datatable-striped ui-datatable-sm"
                             rowKey="#{grupo.id}">

                    <p:ajax event="page" global="false"/>

                    <p:ajax event="sort" global="false"/>

                    <p:column style="width:2rem">

                        <p:rowToggler/>

                    </p:column>

                    <p:column headerText="Descrição" sortBy="#{grupo.descricao}">

                        <h:outputText value="#{grupo.descricao}"/>

                    </p:column>

                    <p:column headerText="Grupo Principal" sortBy="#{grupo.grupoPrincipal.descricao}" width="20%">

                        <h:outputText value="#{grupo.grupoPrincipal.descricao}"/>

                    </p:column>

                    <p:column headerText="Equipe" sortBy="#{grupo.equipes}">

                        <h:outputText value="#{grupo.equipes}"/>

                    </p:column>

                    <p:column headerText="Qtdade. Perguntas" width="5%">

                        <h:outputText value="#{empty grupo.listFaqPergunta ? '' : grupo.listFaqPergunta.size()}"/>

                    </p:column>


                    <p:column width="6%" headerText="Ação" styleClass="text-center">

                        <p:commandButton id="btnGrupoEditar" actionListener="#{faqChatBean.editar(grupo.id)}"
                                         title="Editar grupo" ajax="false"
                                         styleClass="ui-button-flat rounded-button "
                                         icon="fa fw fa-edit"/>

                    </p:column>

                    <p:rowExpansion>

                        <div style="padding: 15px">

                            <p:dataTable id="tablePergunta" var="pergunta" rows="5"
                                         paginator="true" paginatorPosition="bottom"
                                         value="#{grupo.listFaqPergunta}"
                                         emptyMessage="#{grupo.listFaqPergunta eq null? '' : msg.emptyMessage}"
                                         currentPageReportTemplate="[#{msg.totalDeRegistros}: {totalRecords}]"
                                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {Exporters}"
                                         styleClass="ui-datatable-gridlines ui-datatable-striped ui-datatable-sm">

                                <p:column headerText="Ordem" sortBy="#{pergunta.ordem}" width="5%">

                                    <h:outputText value="#{pergunta.ordem}"/>

                                </p:column>

                                <p:column headerText="Pergunta" sortBy="#{pergunta.pergunta}">

                                    <h:outputText value="#{pergunta.pergunta}"/>

                                </p:column>

                                <p:column headerText="Resposta" sortBy="#{pergunta.resposta}">

                                    <h:outputText value="#{pergunta.resposta}"/>

                                </p:column>

                            </p:dataTable>

                        </div>

                    </p:rowExpansion>

                </p:dataTable>

            </div>

        </div>

    </h:form>


</ui:fragment>