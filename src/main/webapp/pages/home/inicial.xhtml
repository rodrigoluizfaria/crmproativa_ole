<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="content">

        <div class="surface-ground px-4 py-5 md:px-6 lg:px-8 h-full">

            <h:form id="formDashboard">

                <div class="flex flex-column md:flex-row justify-content-between align-items-center mb-5 gap-4">
                    <div>
                        <h1 class="text-3xl font-bold text-900 m-0">Dashboard</h1>
                        <span class="text-500 font-medium">Visão geral da operação</span>
                    </div>

                    <div class="surface-card p-2 shadow-1 border-round-2xl flex align-items-center gap-2">
                        <p:selectOneButton id="periodoSelector" value="#{dashboardBean.periodoSelecionado}" unselectable="false">
                            <f:selectItem itemLabel="Hoje" itemValue="DIARIO"/>
                            <f:selectItem itemLabel="7 Dias" itemValue="SEMANAL"/>
                            <f:selectItem itemLabel="Mês" itemValue="MENSAL"/>
                            <f:selectItem itemLabel="Personalizado" itemValue="CUSTOM"/>
                            <p:ajax update="@form" process="@this" listener="#{dashboardBean.atualizarDados()}"/>
                        </p:selectOneButton>

                        <h:panelGroup id="panelCustomDates" rendered="#{dashboardBean.periodoSelecionado eq 'CUSTOM'}" styleClass="flex gap-2 ml-2 animate-fade-in">
                            <p:datePicker value="#{dashboardBean.dataInicio}" pattern="dd/MM" showIcon="false" inputStyleClass="w-6rem text-center border-round-xl text-sm"/>
                            <span class="text-400 flex align-items-center">-</span>
                            <p:datePicker value="#{dashboardBean.dataFim}" pattern="dd/MM" showIcon="false" inputStyleClass="w-6rem text-center border-round-xl text-sm">
                                <p:ajax event="dateSelect" listener="#{dashboardBean.atualizarDados()}" update="@form"/>
                            </p:datePicker>
                        </h:panelGroup>

                        <p:commandButton icon="pi pi-sync" actionListener="#{dashboardBean.atualizarDados()}" update="@form"
                                         styleClass="ui-button-flat ui-button-secondary rounded-button w-3rem h-3rem ml-2"/>
                    </div>
                </div>

                <div class="grid mb-5">
                    <div class="col-12 sm:col-6 lg:col-2">
                        <div class="surface-card shadow-1 p-3 border-round-xl text-center h-full hover:shadow-3 transition-duration-200 cursor-pointer">
                            <div class="inline-flex align-items-center justify-content-center bg-green-50 text-green-600 border-circle w-3rem h-3rem mb-2">
                                <i class="pi pi-users text-xl"></i>
                            </div>
                            <span class="block text-900 font-bold text-2xl mb-1">#{dashboardBean.agentesOnline}</span>
                            <span class="text-500 text-sm font-medium">Online</span>
                        </div>
                    </div>

                    <div class="col-12 sm:col-6 lg:col-2">
                        <div class="surface-card shadow-1 p-3 border-round-xl text-center h-full hover:shadow-3 transition-duration-200">
                            <div class="inline-flex align-items-center justify-content-center bg-blue-50 text-blue-600 border-circle w-3rem h-3rem mb-2">
                                <i class="pi pi-inbox text-xl"></i>
                            </div>
                            <span class="block text-900 font-bold text-2xl mb-1">#{dashboardBean.totalAtendimentosAbertos}</span>
                            <span class="text-500 text-sm font-medium">Aguardando resolutiva</span>
                        </div>
                    </div>

                    <div class="col-12 sm:col-6 lg:col-2">
                        <div class="surface-card shadow-1 p-3 border-round-xl text-center h-full hover:shadow-3 transition-duration-200">
                            <div class="inline-flex align-items-center justify-content-center bg-indigo-50 text-indigo-600 border-circle w-3rem h-3rem mb-2">
                                <i class="pi pi-clock text-xl"></i>
                            </div>
                            <span class="block text-900 font-bold text-2xl mb-1">#{dashboardBean.tmaFormatado}</span>
                            <span class="text-500 text-sm font-medium">TMA</span>
                        </div>
                    </div>

                    <div class="col-12 sm:col-6 lg:col-2">
                        <div class="surface-card shadow-1 p-3 border-round-xl text-center h-full hover:shadow-3 transition-duration-200">
                            <div class="inline-flex align-items-center justify-content-center bg-orange-50 text-orange-600 border-circle w-3rem h-3rem mb-2">
                                <i class="pi pi-check text-xl"></i>
                            </div>
                            <span class="block text-900 font-bold text-2xl mb-1">#{dashboardBean.totalAtendimentosFinalizados}</span>
                            <span class="text-500 text-sm font-medium">Finalizados</span>
                        </div>
                    </div>

                    <div class="col-12 sm:col-6 lg:col-2">
                        <div class="surface-card shadow-1 p-3 border-round-xl text-center h-full hover:shadow-3 transition-duration-200">
                            <div class="inline-flex align-items-center justify-content-center bg-purple-50 text-purple-600 border-circle w-3rem h-3rem mb-2">
                                <i class="pi pi-star text-xl"></i>
                            </div>
                            <span class="block text-900 font-bold text-2xl mb-1">#{dashboardBean.totalFinalizadosN1}</span>
                            <span class="text-500 text-sm font-medium">Resolvido N1</span>
                        </div>
                    </div>

                    <div class="col-12 sm:col-6 lg:col-2">
                        <div class="surface-card shadow-1 p-3 border-round-xl text-center h-full hover:shadow-3 transition-duration-200">
                            <div class="inline-flex align-items-center justify-content-center bg-cyan-50 text-cyan-600 border-circle w-3rem h-3rem mb-2">
                                <i class="pi pi-arrow-up-right text-xl"></i>
                            </div>
                            <span class="block text-900 font-bold text-2xl mb-1">#{dashboardBean.totalDerivadosN2}</span>
                            <span class="text-500 text-sm font-medium">Escalados</span>
                        </div>
                    </div>
                </div>

                <div class="grid">

                    <div class="col-12 lg:col-4">
                        <div class="surface-card shadow-1 border-round-2xl p-4 h-full">
                            <div class="flex justify-content-between align-items-center mb-4">
                                <span class="text-900 font-bold text-lg">Motivos de Contato</span>
                                <p:commandButton icon="pi pi-ellipsis-v" styleClass="ui-button-flat ui-button-secondary rounded-circle w-2rem h-2rem"/>
                            </div>
                            <div class="flex justify-content-center">
                                <p:donutChart model="#{dashboardBean.donutModel}" style="width: 100%; height: 220px;"/>
                            </div>
                        </div>
                    </div>

                    <div class="col-12 lg:col-4">
                        <div class="surface-card shadow-1 border-round-2xl p-4 h-full">
                            <div class="flex justify-content-between align-items-center mb-4">
                                <span class="text-900 font-bold text-lg">Volume por Status</span>
                            </div>
                            <p:barChart model="#{dashboardBean.barModel}" style="width: 100%; height: 220px;"/>
                        </div>
                    </div>

                    <div class="col-12 lg:col-4">
                        <div class="surface-card shadow-1 border-round-2xl p-4 h-full">
                            <div class="flex align-items-center justify-content-between mb-3">
                                <span class="text-900 font-bold text-lg">Top Performance</span>

                                <span class="text-xs font-bold text-green-600 bg-green-100 px-2 py-1 border-round"> #{dashboardBean.periodoRank}</span>
                            </div>

                            <p:dataTable value="#{dashboardBean.listaRanking}" var="rank"
                                         styleClass="ui-datatable-borderless ui-datatable-sm text-sm"
                                         rowStyleClass="border-bottom-1 border-100">

                                <p:column width="10%">
                                    <i class="pi pi-trophy text-yellow-500" rendered="#{rank[2] eq 1}"></i> <span class="text-500 font-medium" >#{rank[2]}</span>
                                </p:column>

                                <p:column headerText="Agente">
                                    <div class="flex align-items-center gap-2">
                                        <p:avatar label="#{rank[0].substring(0,1)}" shape="circle"
                                                  styleClass="bg-blue-50 text-blue-600 text-xs w-2rem h-2rem font-bold"/>
                                        <span class="font-medium text-700">#{rank[0]}</span>
                                    </div>
                                </p:column>

                                <p:column headerText="Qtd" styleClass="text-right">
                                    <span class="font-bold text-900">#{rank[1]}</span>
                                </p:column>
                            </p:dataTable>
                        </div>
                    </div>
                </div>

            </h:form>
        </div>

        <style>
            /* Customizações para deixar os componentes do PrimeFaces mais 'flat' */
            body .ui-selectonebutton .ui-button.ui-state-active {
                background: #EFF6FF; /* blue-50 */
                border-color: #EFF6FF;
                color: #2563EB; /* blue-600 */
                font-weight: 700;
            }
            body .ui-selectonebutton .ui-button {
                background: transparent;
                border: 1px solid transparent;
                color: #64748b;
                transition: all 0.2s;
            }
            body .ui-selectonebutton .ui-button:hover {
                background: #f8fafc;
                color: #334155;
            }

            /* Remove bordas da tabela para look 'clean' */
            body .ui-datatable-borderless .ui-datatable-data > tr > td {
                border-style: none;
                padding: 0.75rem 0.5rem;
            }
            body .ui-datatable .ui-datatable-thead > tr > th {
                background: transparent;
                border: none;
                color: #94a3b8;
                font-size: 0.75rem;
                text-transform: uppercase;
                padding: 0.5rem;
            }
        </style>

    </ui:define>
</ui:composition>