<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:of="http://omnifaces.org/functions"
                template="/WEB-INF/template.xhtml">

    <ui:define name="content">

        <div class="surface-ground px-4 py-5 md:px-6 lg:px-8 h-full">

            <h:form id="formDashboard">

                <h:panelGroup id="painelPausa" layout="block"
                              rendered="#{empty requestScope['javax.servlet.error.message'] and inicialBean.controlePausa ne null}"
                              styleClass="fixed top-0 left-0 w-full h-full flex align-items-center justify-content-center z-5"
                              style="background-color: rgba(0,0,0,0.4); backdrop-filter: blur(2px);">

                    <div class="surface-card shadow-6 border-round-2xl p-0 w-full md:w-6 lg:w-4 overflow-hidden fadein animation-duration-300">

                        <div class="bg-blue-50 border-bottom-1 border-blue-100 p-4 flex align-items-center gap-3">
                            <div class="bg-white border-circle w-4rem h-4rem flex align-items-center justify-content-center shadow-1">
                                <p:graphicImage name="img/pausa.png" width="32"
                                                rendered="#{resource['img/pausa.png'] ne null}"/>
                                <i class="pi pi-pause text-blue-500 text-3xl"
                                   style="display: #{resource['img/pausa.png'] eq null ? 'block' : 'none'}" />
                            </div>
                            <div>
                                <span class="block text-blue-600 font-bold text-sm uppercase mb-1">Status Atual</span>
                                <h1 class="text-900 font-bold text-2xl m-0">EM PAUSA</h1>
                                <span class="text-600 text-lg">#{inicialBean.controlePausa.pausa.descricao}</span>
                            </div>
                        </div>

                        <div class="p-4">

                            <div class="text-center mb-5">
                                <span class="text-500 font-medium text-sm uppercase mb-2 block">Tempo Decorrido</span>
                                <div id="cronometroDisplay" class="text-6xl font-bold text-blue-600 font-monospace">
                                    00:00:00
                                </div>
                            </div>

                            <div class="grid grid-nogutter surface-100 border-round p-3 mb-4">
                                <div class="col-6 border-right-1 border-300 pr-3">
                                    <span class="text-500 text-xs font-bold block mb-1">INÍCIO</span>
                                    <span class="text-900 font-medium text-lg">
                        <h:outputText value="#{inicialBean.controlePausa.dataCadastro}">
                            <f:convertDateTime pattern="HH:mm:ss"/>
                        </h:outputText>
                    </span>
                                    <div class="text-500 text-xs mt-1">
                                        <h:outputText value="#{inicialBean.controlePausa.dataCadastro}">
                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                        </h:outputText>
                                    </div>
                                </div>

                                <div class="col-6 pl-3">
                                    <span class="text-500 text-xs font-bold block mb-1">PREVISÃO RETORNO</span>
                                    <h:panelGroup rendered="#{inicialBean.controlePausa.pausa.tempo ne null}">
                        <span class="text-900 font-medium text-lg">
                             <h:outputText value="#{of:addMinutes(inicialBean.controlePausa.dataCadastro, inicialBean.controlePausa.pausa.tempo)}">
                                <f:convertDateTime pattern="HH:mm:ss"/>
                            </h:outputText>
                        </span>
                                        <div class="text-500 text-xs mt-1">Limite: #{inicialBean.controlePausa.pausa.tempo} min</div>
                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{inicialBean.controlePausa.pausa.tempo eq null}">
                                        <span class="text-700 font-medium text-lg">Indefinido</span>
                                    </h:panelGroup>
                                </div>
                            </div>

                            <p:commandButton value="Retornar ao Trabalho"
                                             actionListener="#{inicialBean.removerPausa()}"
                                             icon="pi pi-play"
                                             styleClass="ui-button-lg ui-button-primary w-full font-bold shadow-2"
                                             ajax="false" />
                        </div>
                    </div>

                    <h:outputScript>
                        (function() {
                        // Pega a data de cadastro vinda do Bean e converte para getTime() (milissegundos)
                        var startTime = #{inicialBean.controlePausa.dataCadastro.time};

                        function updateCounter() {
                        var now = new Date().getTime();
                        var diff = now - startTime;

                        if (diff &lt; 0) diff = 0;

                        // Cálculos
                        var hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        var minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                        var seconds = Math.floor((diff % (1000 * 60)) / 1000);

                        // Formatação com zero à esquerda
                        var strHours = (hours &lt; 10) ? "0" + hours : hours;
                        var strMinutes = (minutes &lt; 10) ? "0" + minutes : minutes;
                        var strSeconds = (seconds &lt; 10) ? "0" + seconds : seconds;

                        var display = document.getElementById('cronometroDisplay');
                        if(display) {
                        display.innerText = strHours + ":" + strMinutes + ":" + strSeconds;
                        }
                        }

                        // Inicia o intervalo e armazena o ID para limpar se necessário (embora ao mudar de página o JS morra)
                        setInterval(updateCounter, 1000);
                        updateCounter(); // Executa a primeira vez imediatamente
                        })();
                    </h:outputScript>

                </h:panelGroup>


                <ui:include src="/pages/dashboard/dashAtendimentoFragmento.xhtml"/>



            </h:form>


        </div>

        <style>
            /* Customizações para deixar os componentes do PrimeFaces mais 'flat' */
            body .ui-selectonebutton .ui-button.ui-state-active {
                background: #EFF6FF; /* blue-50 */
                border-color: #EFF6FF;
                color: #2563EB; /* blue-600 */
                font-weight: 700;
            }
            body .ui-selectonebutton .ui-button {
                background: transparent;
                border: 1px solid transparent;
                color: #64748b;
                transition: all 0.2s;
            }
            body .ui-selectonebutton .ui-button:hover {
                background: #f8fafc;
                color: #334155;
            }

            /* Remove bordas da tabela para look 'clean' */
            body .ui-datatable-borderless .ui-datatable-data > tr > td {
                border-style: none;
                padding: 0.75rem 0.5rem;
            }
            body .ui-datatable .ui-datatable-thead > tr > th {
                background: transparent;
                border: none;
                color: #94a3b8;
                font-size: 0.75rem;
                text-transform: uppercase;
                padding: 0.5rem;
            }
        </style>



    </ui:define>
</ui:composition>